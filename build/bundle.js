module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=99)}([function(e,t,r){var n=t.global=r(66),i=t.hasBuffer=n&&!!n.isBuffer,o=t.hasArrayBuffer="undefined"!=typeof ArrayBuffer,s=t.isArray=r(8);t.isArrayBuffer=o?function(e){return e instanceof ArrayBuffer||p(e)}:v;var a=t.isBuffer=i?n.isBuffer:v,u=t.isView=o?ArrayBuffer.isView||y("ArrayBuffer","buffer"):v;t.alloc=d,t.concat=function(e,r){r||(r=0,Array.prototype.forEach.call(e,function(e){r+=e.length}));var n=this!==t&&this||e[0],i=d.call(n,r),o=0;return Array.prototype.forEach.call(e,function(e){o+=h.copy.call(e,i,o)}),i},t.from=function(e){return"string"==typeof e?function(e){var t=3*e.length,r=d.call(this,t),n=h.write.call(r,e);t!==n&&(r=h.slice.call(r,0,n));return r}.call(this,e):g(this).from(e)};var c=t.Array=r(68),f=t.Buffer=r(69),l=t.Uint8Array=r(70),h=t.prototype=r(14);function d(e){return g(this).alloc(e)}var p=y("ArrayBuffer");function g(e){return a(e)?f:u(e)?l:s(e)?c:i?f:o?l:c}function v(){return!1}function y(e,t){return e="[object "+e+"]",function(r){return null!=r&&{}.toString.call(t?r[t]:r)===e}}},function(e,t){e.exports=require("auth0-extension-tools@1.3.1")},function(e,t){e.exports=require("util")},function(e,t,r){e.exports=r(1).config()},function(e,t,r){const n=r(55),i=r(23),o=r(48),s=r(54);e.exports.createServer=n.createServer,e.exports.urlHelpers=i,e.exports.middlewares=o,e.exports.routes=s},function(e,t){e.exports=require("express@4.12.4")},function(e,t){e.exports=require("stream")},function(e,t,r){const n=r(115);n.emitErrs=!0;const i=new n.Logger({transports:[new n.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});e.exports=i,e.exports.stream={write:e=>{i.info(e.replace(/\n$/,""))}}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){var n=r(8);t.createCodec=a,t.install=function(e){for(var t in e)o.prototype[t]=s(o.prototype[t],e[t])},t.filter=function(e){return n(e)?function(e){return e=e.slice(),function(r){return e.reduce(t,r)};function t(e,t){return t(e)}}(e):e};var i=r(0);function o(e){if(!(this instanceof o))return new o(e);this.options=e,this.init()}function s(e,t){return e&&t?function(){return e.apply(this,arguments),t.apply(this,arguments)}:e||t}function a(e){return new o(e)}o.prototype.init=function(){var e=this.options;return e&&e.uint8array&&(this.bufferish=i.Uint8Array),this},t.preset=a({preset:!0})},function(e,t,r){"use strict";!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,t)});case 3:return process.nextTick(function(){e.call(null,t,r)});case 4:return process.nextTick(function(){e.call(null,t,r,n)});default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return process.nextTick(function(){e.apply(null,i)})}}}:e.exports=process},function(e,t,r){"use strict";var n=r(10),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=l;var o=r(21);o.inherits=r(12);var s=r(90),a=r(35);o.inherits(l,s);for(var u=i(a.prototype),c=0;c<u.length;c++){var f=u[c];l.prototype[f]||(l.prototype[f]=a.prototype[f])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t,r){try{var n=r(2);if("function"!=typeof n.inherits)throw"";e.exports=n.inherits}catch(t){e.exports=r(61)}},function(e,t){!function(e){var t,r="undefined",n=r!==typeof Buffer&&Buffer,i=r!==typeof Uint8Array&&Uint8Array,o=r!==typeof ArrayBuffer&&ArrayBuffer,s=[0,0,0,0,0,0,0,0],a=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},u=4294967296,c=16777216;function f(a,f,x){var E=f?0:4,_=f?4:0,k=f?0:3,S=f?1:2,T=f?2:1,A=f?3:0,U=f?y:w,C=f?m:b,M=R.prototype,B="is"+a,L="_"+B;return M.buffer=void 0,M.offset=0,M[L]=!0,M.toNumber=I,M.toString=function(e){var t=this.buffer,r=this.offset,n=N(t,r+E),i=N(t,r+_),o="",s=!x&&2147483648&n;s&&(n=~n,i=u-i);e=e||10;for(;;){var a=n%e*u+i;if(n=Math.floor(n/e),i=Math.floor(a/e),o=(a%e).toString(e)+o,!n&&!i)break}s&&(o="-"+o);return o},M.toJSON=I,M.toArray=l,n&&(M.toBuffer=h),i&&(M.toArrayBuffer=d),R[B]=function(e){return!(!e||!e[L])},e[a]=R,R;function R(e,n,a,c){return this instanceof R?function(e,n,a,c,f){i&&o&&(n instanceof o&&(n=new i(n)),c instanceof o&&(c=new i(c)));if(!(n||a||c||t))return void(e.buffer=v(s,0));if(!p(n,a)){var l=t||Array;f=a,c=n,a=0,n=new l(8)}if(e.buffer=n,e.offset=a|=0,r===typeof c)return;"string"==typeof c?function(e,t,r,n){var i=0,o=r.length,s=0,a=0;"-"===r[0]&&i++;var c=i;for(;i<o;){var f=parseInt(r[i++],n);if(!(f>=0))break;a=a*n+f,s=s*n+Math.floor(a/u),a%=u}c&&(s=~s,a?a=u-a:s++);O(e,t+E,s),O(e,t+_,a)}(n,a,c,f||10):p(c,f)?g(n,a,c,f):"number"==typeof f?(O(n,a+E,c),O(n,a+_,f)):c>0?U(n,a,c):c<0?C(n,a,c):g(n,a,s,0)}(this,e,n,a,c):new R(e,n,a,c)}function I(){var e=this.buffer,t=this.offset,r=N(e,t+E),n=N(e,t+_);return x||(r|=0),r?r*u+n:n}function O(e,t,r){e[t+A]=255&r,r>>=8,e[t+T]=255&r,r>>=8,e[t+S]=255&r,r>>=8,e[t+k]=255&r}function N(e,t){return e[t+k]*c+(e[t+S]<<16)+(e[t+T]<<8)+e[t+A]}}function l(e){var r=this.buffer,n=this.offset;return t=null,!1!==e&&0===n&&8===r.length&&a(r)?r:v(r,n)}function h(e){var r=this.buffer,i=this.offset;if(t=n,!1!==e&&0===i&&8===r.length&&Buffer.isBuffer(r))return r;var o=new n(8);return g(o,0,r,i),o}function d(e){var r=this.buffer,n=this.offset,s=r.buffer;if(t=i,!1!==e&&0===n&&s instanceof o&&8===s.byteLength)return s;var a=new i(8);return g(a,0,r,n),a.buffer}function p(e,t){var r=e&&e.length;return t|=0,r&&t+8<=r&&"string"!=typeof e[t]}function g(e,t,r,n){t|=0,n|=0;for(var i=0;i<8;i++)e[t++]=255&r[n++]}function v(e,t){return Array.prototype.slice.call(e,t,t+8)}function y(e,t,r){for(var n=t+8;n>t;)e[--n]=255&r,r/=256}function m(e,t,r){var n=t+8;for(r++;n>t;)e[--n]=255&-r^255,r/=256}function w(e,t,r){for(var n=t+8;t<n;)e[t++]=255&r,r/=256}function b(e,t,r){var n=t+8;for(r++;t<n;)e[t++]=255&-r^255,r/=256}f("Uint64BE",!0,!0),f("Int64BE",!0,!1),f("Uint64LE",!1,!0),f("Int64LE",!1,!1)}("object"==typeof t&&"string"!=typeof t.nodeName?t:this||{})},function(e,t,r){var n=r(67);t.copy=u,t.slice=c,t.toString=function(e,t,r){return(!s&&i.isBuffer(this)?this.toString:n.toString).apply(this,arguments)},t.write=function(e){return function(){return(this[e]||n[e]).apply(this,arguments)}}("write");var i=r(0),o=i.global,s=i.hasBuffer&&"TYPED_ARRAY_SUPPORT"in o,a=s&&!o.TYPED_ARRAY_SUPPORT;function u(e,t,r,o){var s=i.isBuffer(this),u=i.isBuffer(e);if(s&&u)return this.copy(e,t,r,o);if(a||s||u||!i.isView(this)||!i.isView(e))return n.copy.call(this,e,t,r,o);var f=r||null!=o?c.call(this,r,o):this;return e.set(f,t),f.length}function c(e,t){var r=this.slice||!a&&this.subarray;if(r)return r.call(this,e,t);var n=i.alloc.call(this,t-e);return u.call(this,n,0,e,t),n}},function(e,t,r){t.DecodeBuffer=i;var n=r(18).preset;function i(e){if(!(this instanceof i))return new i(e);if(e&&(this.options=e,e.codec)){var t=this.codec=e.codec;t.bufferish&&(this.bufferish=t.bufferish)}}r(32).FlexDecoder.mixin(i.prototype),i.prototype.codec=n,i.prototype.fetch=function(){return this.codec.decode(this)}},function(e,t,r){t.EncodeBuffer=i;var n=r(19).preset;function i(e){if(!(this instanceof i))return new i(e);if(e&&(this.options=e,e.codec)){var t=this.codec=e.codec;t.bufferish&&(this.bufferish=t.bufferish)}}r(32).FlexEncoder.mixin(i.prototype),i.prototype.codec=n,i.prototype.write=function(e){this.codec.encode(this,e)}},function(e,t,r){t.ExtBuffer=function e(t,r){if(!(this instanceof e))return new e(t,r);this.buffer=n.from(t);this.type=r};var n=r(0)},function(e,t,r){var n=r(17).ExtBuffer,i=r(77),o=r(33).readUint8,s=r(79),a=r(9);function u(){var e=this.options;return this.decode=function(e){var t=s.getReadToken(e);return function(e){var r=o(e),n=t[r];if(!n)throw new Error("Invalid type: "+(r?"0x"+r.toString(16):r));return n(e)}}(e),e&&e.preset&&i.setExtUnpackers(this),this}a.install({addExtUnpacker:function(e,t){(this.extUnpackers||(this.extUnpackers=[]))[e]=a.filter(t)},getExtUnpacker:function(e){return(this.extUnpackers||(this.extUnpackers=[]))[e]||function(t){return new n(t,e)}},init:u}),t.preset=u.call(a.preset)},function(e,t,r){var n=r(17).ExtBuffer,i=r(76),o=r(81),s=r(9);function a(){var e=this.options;return this.encode=function(e){var t=o.getWriteType(e);return function(e,r){var n=t[typeof r];if(!n)throw new Error('Unsupported type "'+typeof r+'": '+r);n(e,r)}}(e),e&&e.preset&&i.setExtPackers(this),this}s.install({addExtPacker:function(e,t,r){r=s.filter(r);var i=t.name;if(i&&"Object"!==i){var o=this.extPackers||(this.extPackers={});o[i]=u}else{var a=this.extEncoderList||(this.extEncoderList=[]);a.unshift([t,u])}function u(t){return r&&(t=r(t)),new n(t,e)}},getExtPacker:function(e){var t=this.extPackers||(this.extPackers={}),r=e.constructor,n=r&&r.name&&t[r.name];if(n)return n;for(var i=this.extEncoderList||(this.extEncoderList=[]),o=i.length,s=0;s<o;s++){var a=i[s];if(r===a[0])return a[1]}},init:a}),t.preset=a.call(s.preset)},function(e,t,r){var n=r(39),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t){e.exports=require("core-util-is@1.0.1")},function(e,t){e.exports=require("url")},function(e,t,r){const n=r(22),i=3,o=2,s=1,a=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports.getBasePath=function(e){return t=e.originalUrl||"",r=e.path,(i=(i=n.parse(t).pathname||"").replace(r,"").replace(/^\/|\/$/g,"")).startsWith("/")||(i="/"+i),i.endsWith("/")||(i+="/"),i;var t,r,i},e.exports.getBaseUrl=function(e,t){var r=t;const i=n.parse(e.originalUrl||"").pathname||"";return n.format({protocol:r||"https",host:e.headers.host,pathname:i.replace(e.path,"").replace(/\/$/g,"")})},e.exports.getWebtaskUrl=function(e){const t=function(e){if(!e.container)return null;const t=e.container.replace(a,"\\$&"),r=e.jtn?e.jtn.replace(a,"\\$&"):"";if(e.url_format===s)return new RegExp("^/api/run/"+t+"/(?:"+r+"/?)?");if(e.url_format===o)return new RegExp("^/"+t+"/(?:"+r+"/?)?");if(e.url_format===i)return new RegExp("^/(?:"+r+"/?)?");throw new Error("Unsupported webtask URL format.")}(e.x_wt),r=e.url,u=e.url.replace(t,"/"),c=n.parse(u||"").pathname,f=e.x_wt&&e.x_wt.ectx&&e.x_wt.ectx.ISOLATED_DOMAIN||!1,l=n.parse(r||"").pathname||"";var h;if(f){h=n.format({protocol:"https",host:e.headers.host,pathname:l.replace(c,"").replace(/\/$/g,"")});const t=".it.auth0.com/api/run/"+e.x_wt.container+"/",r=function(e,t){if(!e)return null;const r=e.indexOf("sandbox8")>=0?"8":"";return"https://"+t+"."+(e.split(".it.auth0.com")[0].split("-")[1]||"us")+r+".webtask.io/"}(h,e.x_wt.container);h.indexOf(t)>=0&&(h=h.replace("https://"+e.headers.host+"/api/run/"+e.x_wt.container+"/",r))}else h=l;return h}},function(e,t,r){!function(t){e.exports=t;var r="listeners",n={on:function(e,t){return s(this,e).push(t),this},once:function(e,t){var r=this;return n.originalListener=t,s(r,e).push(n),r;function n(){o.call(r,e,n),t.apply(this,arguments)}},off:o,emit:function(e,t){var r=this,n=s(r,e,!0);if(!n)return!1;var i=arguments.length;if(1===i)n.forEach(function(e){e.call(r)});else if(2===i)n.forEach(function(e){e.call(r,t)});else{var o=Array.prototype.slice.call(arguments,1);n.forEach(function(e){e.apply(r,o)})}return!!n.length}};function i(e){for(var t in n)e[t]=n[t];return e}function o(e,t){var n;if(arguments.length){if(t){if(n=s(this,e,!0)){if(!(n=n.filter(function(e){return e!==t&&e.originalListener!==t})).length)return o.call(this,e);this[r][e]=n}}else if((n=this[r])&&(delete n[e],!Object.keys(n).length))return o.call(this)}else delete this[r];return this}function s(e,t,n){if(!n||e[r]){var i=e[r]||(e[r]={});return i[t]||(i[t]=[])}}i(t.prototype),t.mixin=i}(function e(){if(!(this instanceof e))return new e})},function(e,t,r){"use strict";const n=r(82);e.exports=((e,t,r)=>(i,o,s)=>{const a=n(s);return!0===e||"function"==typeof e&&e(i,o,a)?t(i,o,a):r?r(i,o,a):a()})},function(e,t,r){"use strict";e.exports=class e{constructor(e,t){this.epoch=e,this.nano=t}static pack(e){const t=Buffer.allocUnsafe(8);return t.writeUInt32BE(e.epoch,0),t.writeUInt32BE(e.nano,4),t}static unpack(t){const r=t.readUInt32BE(0),n=t.readUInt32BE(4);return new e(r,n)}static now(){const t=Date.now();return e.fromTimestamp(t)}static fromDate(t){const r=t.getTime();return e.fromTimestamp(r)}static fromTimestamp(t){const r=Math.floor(t/1e3);return new e(r,t%1e3*1e6)}}},function(e,t,r){"use strict";const n=r(41).EventEmitter,i=r(65),o=r(111),s=r(6),a=r(40),u=r(113),c=r(117),f=r(59),l=r(26),h=i.createCodec();h.addExtPacker(0,l,l.pack),h.addExtUnpacker(0,l.unpack);class d{constructor(e,t){if(t=t||{},this._eventMode=t.eventMode||"Message",!/^Message|PackedForward|CompressedPackedForward$/.test(this._eventMode))throw new f.ConfigError("Unknown event mode: "+this._eventMode);this.tag_prefix=e,this.host=t.host||"localhost",this.port=t.port||24224,this.path=t.path,this.timeout=t.timeout||3,this.tls=!!t.tls,this.tlsOptions=t.tlsOptions||{},this.enableReconnect="boolean"!=typeof t.enableReconnect||t.enableReconnect,this.reconnectInterval=t.reconnectInterval||6e5,this.requireAckResponse=t.requireAckResponse,this.ackResponseTimeout=t.ackResponseTimeout||19e4,this.internalLogger=t.internalLogger||console,this._timeResolution=t.milliseconds?1:1e3,this._socket=null,"Message"===this._eventMode?(this._sendQueue=[],this._flushInterval=0):(this._sendQueue=new Map,this._flushInterval=t.flushInterval||100,this._sendQueueSizeLimit=t.sendQueueSizeLimit||8388608,this._sendQueueSize=0,this._flushSendQueueTimeoutId=null,this._compressed="CompressedPackedForward"===this._eventMode),this._eventEmitter=new n,this.security=t.security||{clientHostname:null,sharedKey:null,username:"",password:""},this.sharedKeySalt=a.randomBytes(16).toString("hex"),this._status=null,this._connecting=!1}emit(e,t,r,n){let i,o,s,a,u,c;"string"==typeof e?(i=e,o=t,u=r,c=n):(o=e,u=t,c=r),"function"==typeof u?a=u:u&&(s=u,"function"==typeof c&&(a=c));const l=this._makeTag(i);let h,d;return null===l?(d={tag_prefix:this.tag_prefix,label:i},h=new f.MissingTag("tag is missing",d),void this._handleEvent("error",h,a)):"object"!=typeof o?(d={tag_prefix:this.tag_prefix,label:i,record:o},h=new f.DataTypeError("data must be an object",d),void this._handleEvent("error",h,a)):(this._push(l,s,o,a),void this._connect(()=>{this._flushSendQueue()}))}end(e,t,r){null!=e&&null!=t?this.emit(e,t,e=>{this._close(),e?this._handleEvent("error",e,r):r&&r()}):process.nextTick(()=>{this._close(),r&&r()})}_close(){this._socket&&(this._socket.end(),this._socket=null,this._status=null)}_makeTag(e){let t=null;return this.tag_prefix&&e?t=`${this.tag_prefix}.${e}`:this.tag_prefix?t=this.tag_prefix:e&&(t=e),t}_makePacketItem(e,t,r){t&&("number"==typeof t||t instanceof l)||(t=Math.floor((t?t.getTime():Date.now())/this._timeResolution));const n=[e,t,r];let o={};return this.requireAckResponse&&(o={chunk:a.randomBytes(16).toString("base64")},n.push(o)),{packet:i.encode(n,{codec:h}),tag:e,time:t,data:r,options:o}}_makeEventEntry(e,t){return e&&("number"==typeof e||e instanceof l)||(e=Math.floor((e?e.getTime():Date.now())/this._timeResolution)),i.encode([e,t],{codec:h})}_push(e,t,r,n){if("Message"===this._eventMode){let i=this._makePacketItem(e,t,r);i.callback=n,this._sendQueue.push(i)}else{const i=this._makeEventEntry(t,r);if(this._sendQueueSize+=i.length,this._sendQueue.has(e)){let t=this._sendQueue.get(e);t.eventEntries.push(i),n&&t.callbacks.push(n)}else{const t=n?[n]:[];this._sendQueue.set(e,{eventEntries:[i],callbacks:t})}}}_connect(e){this._connecting||(null===this._socket?(this._connecting=!0,this._doConnect(()=>{this._connecting=!1,e()})):this._socket.writable?(this._connecting=!1,process.nextTick(e)):(this._disconnect(),this._connect(e)))}_doConnect(e){let t=()=>{let e=e=>{this._socket&&(this._disconnect(),this._handleEvent("error",e))};this._socket.on("error",e),this._socket.on("connect",()=>{this._handleEvent("connect")}),this.tls&&(this._socket.on("tlsClientError",e),this._socket.on("secureConnect",()=>{this._handleEvent("connect")}))};if(this.tls||(this._socket=new o.Socket,this._socket.setTimeout(this.timeout),t()),this.path)this.tls?(this._socket=u.connect(Object.assign({},this.tlsOptions,{path:this.path}),()=>{e()}),t()):this._socket.connect(this.path,()=>{e()});else{let r=()=>{this.security.clientHostname&&null!==this.security.sharedKey?this._handshake(e):(this._status="established",e())};this.tls?(this._socket=u.connect(Object.assign({},this.tlsOptions,{host:this.host,port:this.port}),()=>{r()}),t()):this._socket.connect(this.port,this.host,()=>{r()})}}_disconnect(){this._socket&&this._socket.destroy(),this._socket=null,this._status=null,this._connecting=!1}_handshake(e){"established"!==this._status&&(this._status="helo",this._socket.once("data",t=>{if(this._socket.pause(),!this._checkHelo(t).succeeded)return this.internalLogger.error("Received invalid HELO message from "+this._socket.remoteAddress),void this._disconnect();this._status="pingpong",this._socket.write(this._generatePing(),()=>{this._socket.resume(),this._socket.once("data",t=>{const r=this._checkPong(t);if(!r.succeeded){this.internalLogger.error(r.message);const e=new f.HandshakeError(r.message);return this._handleEvent("error",e),void this._disconnect()}this._status="established",this.internalLogger.info("Established"),e()})})}))}_flushSendQueue(){this._flushingSendQueue||(this._flushingSendQueue=!0,this._waitToWrite())}_waitToWrite(){this._socket?this._socket.writable?"Message"===this._eventMode?this._doFlushSendQueue():this._sendQueueSize>=this._sendQueueSizeLimit?(this._flushSendQueueTimeoutId&&clearTimeout(this._flushSendQueueTimeoutId),this._doFlushSendQueue()):(this._flushSendQueueTimeoutId&&clearTimeout(this._flushSendQueueTimeoutId),this._flushSendQueueTimeoutId=setTimeout(()=>{this._doFlushSendQueue()},this._flushInterval)):process.nextTick(()=>{this._waitToWrite()}):this._flushingSendQueue=!1}_doFlushSendQueue(e){if("Message"===this._eventMode){let t=this._sendQueue.shift();if(void 0===t)return void(this._flushingSendQueue=!1);this._doWrite(t.packet,t.options,e,[t.callback])}else{if(0===this._sendQueue.size)return void(this._flushingSendQueue=!1);let t=this._sendQueue.entries().next().value,r=t[0],n=t[1],o=Buffer.concat(n.eventEntries,this._sendQueueSize),s=o.length;this._sendQueue.delete(r),this._compressed&&(s=(o=c.gzipSync(o)).length);const u={chunk:a.randomBytes(16).toString("base64"),size:s,compressed:this._compressed?"gzip":"text"},f=i.encode([r,o,u],{codec:h});this._doWrite(f,u,e,n.callbacks)}}_doWrite(e,t,r,n){const o=this._sendQueueSize;this._socket.write(e,()=>{this.requireAckResponse?(this._socket.once("data",e=>{r&&clearTimeout(r);const s=i.decode(e,{codec:h});if(s.ack!==t.chunk){const e=new f.ResponseError("ack in response and chunk id in sent data are different",{ack:s.ack,chunk:t.chunk});n.forEach(t=>{this._handleEvent("error",e,t)})}this._sendQueueSize-=o,n.forEach(e=>{e&&e()}),process.nextTick(()=>{this._waitToWrite()})}),r=setTimeout(()=>{const e=new f.ResponseTimeout("ack response timeout");n.forEach(t=>{this._handleEvent("error",e,t)})},this.ackResponseTimeout)):(this._sendQueueSize-=o,n.forEach(e=>{e&&e()}),process.nextTick(()=>{this._waitToWrite()}))})}_handleEvent(e,t,r){r&&r(t),this._eventEmitter.listenerCount(e)>0&&this._eventEmitter.emit(e,t)}_setupErrorHandler(e){this.reconnectInterval&&this.enableReconnect&&this.on("error",t=>{this._flushingSendQueue=!1,this._status=null,this.internalLogger.error("Fluentd error",t),this.internalLogger.info("Fluentd will reconnect after "+this.reconnectInterval/1e3+" seconds");let r=setTimeout(()=>{this.internalLogger.info("Fluentd is reconnecting..."),this._connect(()=>{this._flushSendQueue(),this.internalLogger.info("Fluentd reconnection finished!!")})},this.reconnectInterval);e&&e(r)})}_checkHelo(e){this.internalLogger.info("Checking HELO...");const t=i.decode(e);if(2!==t.length)return{succeeded:!1,message:"Invalid format for HELO message"};if("HELO"!==t[0])return{succeeded:!1,message:"Invalid format for HELO message"};const r=t[1]||{};return this.sharedKeyNonce=r.nonce||"",this.authentication=r.auth||"",{succeeded:!0}}_generatePing(){const e=a.createHash("sha512").update(this.sharedKeySalt).update(this.security.clientHostname).update(this.sharedKeyNonce).update(this.security.sharedKey).digest("hex"),t=["PING",this.security.clientHostname,this.sharedKeySalt,e];if(Buffer.isBuffer(this.authentication)&&0!==this.authentication.length){const e=a.createHash("sha512").update(this.authentication).update(this.security.username||"").update(this.security.password||"").digest("hex");t.push(this.security.username,e)}else t.push("","");return i.encode(t)}_checkPong(e){this.internalLogger.info("Checking PONG...");const t=i.decode(e);if(5!==t.length)return!1;if("PONG"!==t[0])return{succeeded:!1,message:"Invalid format for PONG message"};t[0];const r=t[1],n=t[2],o=t[3],s=t[4];return r?o===this.security.clientHostname?{succeeded:!1,message:"Same hostname between input and output: invalid configuration"}:s!==a.createHash("sha512").update(this.sharedKeySalt).update(o).update(this.sharedKeyNonce).update(this.security.sharedKey).digest("hex")?{succeeded:!1,message:"Sharedkey mismatch"}:{succeeded:!0}:{succeeded:!1,message:"Authentication failed: "+n}}toStream(e){const t=(e="string"==typeof e?{label:e}:e||{}).label;if(!t)throw new Error("label is needed");const r=e.encoding||"UTF-8",n=new s.Writable;let i="";return n._write=((e,n,o)=>{const s=e.toString(r).split(/\n/);let a=()=>{s.length&&(i+=s.shift()),s.length?this.emit(t,{message:i},e=>{e?this._handleEvent("error",e,o):(i="",a())}):process.nextTick(o)};a()}),n}}["addListener","on","once","removeListener","removeAllListeners","setMaxListeners","getMaxListeners"].forEach((e,t)=>{d.prototype[e]=function(){return this._eventEmitter[e].apply(this._eventEmitter,Array.from(arguments))}}),e.exports=d},function(e,t){t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,f=-7,l=r?i-1:0,h=r?-1:1,d=e[t+l];for(l+=h,o=d&(1<<-f)-1,d>>=-f,f+=a;f>0;o=256*o+e[t+l],l+=h,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=n;f>0;s=256*s+e[t+l],l+=h,f-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=c}return(d?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,f=(1<<c)-1,l=f>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+l>=1?h/u:h*Math.pow(2,1-l))*u>=2&&(s++,u/=2),s+l>=f?(a=0,s=f):s+l>=1?(a=(t*u-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[r+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+d]=255&s,d+=p,s/=256,c-=8);e[r+d-p]|=128*g}},function(e,t,r){"use strict";var n=r(64);function i(e){this.message=e}i.prototype=new Error,i.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new i("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(n(e.split(".")[r]))}catch(e){throw new i("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=i},function(e,t,r){t.decode=function(e,t){var r=new n(t);return r.write(e),r.read()};var n=r(15).DecodeBuffer},function(e,t,r){t.encode=function(e,t){var r=new n(t);return r.write(e),r.read()};var n=r(16).EncodeBuffer},function(e,t,r){t.FlexDecoder=a,t.FlexEncoder=u;var n=r(0),i=2048,o=65536,s="BUFFER_SHORTAGE";function a(){if(!(this instanceof a))return new a}function u(){if(!(this instanceof u))return new u}function c(){throw new Error("method not implemented: write()")}function f(){throw new Error("method not implemented: fetch()")}function l(){return this.buffers&&this.buffers.length?(this.flush(),this.pull()):this.fetch()}function h(e){(this.buffers||(this.buffers=[])).push(e)}function d(){return(this.buffers||(this.buffers=[])).shift()}function p(e){return function(t){for(var r in e)t[r]=e[r];return t}}a.mixin=p(function(){return{bufferish:n,write:function(e){var t=this.offset?n.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=t?e?this.bufferish.concat([t,e]):t:e,this.offset=0},fetch:f,flush:function(){for(;this.offset<this.buffer.length;){var e,t=this.offset;try{e=this.fetch()}catch(e){if(e&&e.message!=s)throw e;this.offset=t;break}this.push(e)}},push:h,pull:d,read:l,reserve:function(e){var t=this.offset,r=t+e;if(r>this.buffer.length)throw new Error(s);return this.offset=r,t},offset:0}}()),a.mixin(a.prototype),u.mixin=p(function(){return{bufferish:n,write:c,fetch:function(){var e=this.start;if(e<this.offset){var t=this.start=this.offset;return n.prototype.slice.call(this.buffer,e,t)}},flush:function(){for(;this.start<this.offset;){var e=this.fetch();e&&this.push(e)}},push:h,pull:function(){var e=this.buffers||(this.buffers=[]),t=e.length>1?this.bufferish.concat(e):e[0];return e.length=0,t},read:l,reserve:function(e){var t=0|e;if(this.buffer){var r=this.buffer.length,n=0|this.offset,i=n+t;if(i<r)return this.offset=i,n;this.flush(),e=Math.max(e,Math.min(2*r,this.maxBufferSize))}return e=Math.max(e,this.minBufferSize),this.buffer=this.bufferish.alloc(e),this.start=0,this.offset=t,0},send:function(e){var t=e.length;if(t>this.minBufferSize)this.flush(),this.push(e);else{var r=this.reserve(t);n.prototype.copy.call(e,this.buffer,r)}},maxBufferSize:o,minBufferSize:i,offset:0,start:0}}()),u.mixin(u.prototype)},function(e,t,r){var n=r(28),i=r(13),o=i.Uint64BE,s=i.Int64BE;t.getReadFormat=function(e){var t=a.hasArrayBuffer&&e&&e.binarraybuffer,r=e&&e.int64;return{map:c&&e&&e.usemap?h:l,array:d,str:p,bin:t?v:g,ext:y,uint8:m,uint16:b,uint32:E,uint64:k(8,r?A:S),int8:w,int16:x,int32:_,int64:k(8,r?U:T),float32:k(4,C),float64:k(8,M)}},t.readUint8=m;var a=r(0),u=r(14),c="undefined"!=typeof Map,f=!0;function l(e,t){var r,n={},i=new Array(t),o=new Array(t),s=e.codec.decode;for(r=0;r<t;r++)i[r]=s(e),o[r]=s(e);for(r=0;r<t;r++)n[i[r]]=o[r];return n}function h(e,t){var r,n=new Map,i=new Array(t),o=new Array(t),s=e.codec.decode;for(r=0;r<t;r++)i[r]=s(e),o[r]=s(e);for(r=0;r<t;r++)n.set(i[r],o[r]);return n}function d(e,t){for(var r=new Array(t),n=e.codec.decode,i=0;i<t;i++)r[i]=n(e);return r}function p(e,t){var r=e.reserve(t),n=r+t;return u.toString.call(e.buffer,"utf-8",r,n)}function g(e,t){var r=e.reserve(t),n=r+t,i=u.slice.call(e.buffer,r,n);return a.from(i)}function v(e,t){var r=e.reserve(t),n=r+t,i=u.slice.call(e.buffer,r,n);return a.Uint8Array.from(i).buffer}function y(e,t){var r=e.reserve(t+1),n=e.buffer[r++],i=r+t,o=e.codec.getExtUnpacker(n);if(!o)throw new Error("Invalid ext type: "+(n?"0x"+n.toString(16):n));return o(u.slice.call(e.buffer,r,i))}function m(e){var t=e.reserve(1);return e.buffer[t]}function w(e){var t=e.reserve(1),r=e.buffer[t];return 128&r?r-256:r}function b(e){var t=e.reserve(2),r=e.buffer;return r[t++]<<8|r[t]}function x(e){var t=e.reserve(2),r=e.buffer,n=r[t++]<<8|r[t];return 32768&n?n-65536:n}function E(e){var t=e.reserve(4),r=e.buffer;return 16777216*r[t++]+(r[t++]<<16)+(r[t++]<<8)+r[t]}function _(e){var t=e.reserve(4),r=e.buffer;return r[t++]<<24|r[t++]<<16|r[t++]<<8|r[t]}function k(e,t){return function(r){var n=r.reserve(e);return t.call(r.buffer,n,f)}}function S(e){return new o(this,e).toNumber()}function T(e){return new s(this,e).toNumber()}function A(e){return new o(this,e)}function U(e){return new s(this,e)}function C(e){return n.read(this,e,!1,23,4)}function M(e){return n.read(this,e,!1,52,8)}},function(e,t){for(var r=t.uint8=new Array(256),n=0;n<=255;n++)r[n]=i(n);function i(e){return function(t){var r=t.reserve(1);t.buffer[r]=e}}},function(e,t,r){"use strict";var n=r(10);function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=v;var o,s=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:n.nextTick;v.WritableState=g;var a=r(21);a.inherits=r(12);var u={deprecate:r(88)},c=r(37),f=r(20).Buffer,l=global.Uint8Array||function(){};var h,d=r(36);function p(){}function g(e,t){o=o||r(11),e=e||{};var a=t instanceof o;this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var u=e.highWaterMark,c=e.writableHighWaterMark,f=this.objectMode?16:16384;this.highWaterMark=u||0===u?u:a&&(c||0===c)?c:f,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,o=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,o){--t.pendingcb,r?(n.nextTick(o,i),n.nextTick(E,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(o(i),e._writableState.errorEmitted=!0,e.emit("error",i),E(e,t))}(e,r,i,t,o);else{var a=b(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||w(e,r),i?s(m,e,r,a,o):m(e,r,a,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function v(e){if(o=o||r(11),!(h.call(v,this)||this instanceof o))return new v(e);this._writableState=new g(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function y(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function m(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),E(e,t)}function w(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,o=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var a=0,u=!0;r;)o[a]=r,r.isBuf||(u=!1),r=r.next,a+=1;o.allBuffers=u,y(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,f=r.encoding,l=r.callback;if(y(e,t,!1,t.objectMode?1:c.length,c,f,l),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function b(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function x(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),E(e,t)})}function E(e,t){var r=b(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,n.nextTick(x,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}a.inherits(v,c),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(h=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(e){return!!h.call(this,e)||this===v&&(e&&e._writableState instanceof g)}})):h=function(e){return e instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(e,t,r){var i,o=this._writableState,s=!1,a=!o.objectMode&&(i=e,f.isBuffer(i)||i instanceof l);return a&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof r&&(r=p),o.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),n.nextTick(t,r)}(this,r):(a||function(e,t,r,i){var o=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),n.nextTick(i,s),o=!1),o}(this,o,e,r))&&(o.pendingcb++,s=function(e,t,r,n,i,o){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,r));return t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else y(e,t,!1,a,n,i,o);return u}(this,o,a,e,t,r)),s},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},v.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(e,t,r){var i=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,r){t.ending=!0,E(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,i,r)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),v.prototype.destroy=d.destroy,v.prototype._undestroy=d.undestroy,v.prototype._destroy=function(e,t){this.end(),t(e)}},function(e,t,r){"use strict";var n=r(10);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,r){e.exports=r(6)},function(e,t,r){"use strict";var n=r(93).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=f,this.end=l,t=3;break;default:return this.write=h,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function f(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=s(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t){e.exports=require("buffer")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("express-jwt@3.1.0")},function(e,t){e.exports=require("path")},function(e,t,r){(function(t){r(22);const n=r(43),i=r(110),o=r(5),s=r(102),a=r(1),u=r(4),c=r(97),f=r(98),l=r(95),h=r(7),d=r(3),p=r(94);e.exports=((e,r)=>{d.setProvider(e);const g=r?new a.WebtaskStorageContext(r,{force:1}):new a.FileStorageContext(n.join(t,"./data.json"),{mergeWrites:!0}),v=new o;v.use(i(":method :url :status :response-time ms - :res[content-length]",{stream:h.stream}));const y=e=>(t,r,n)=>t.webtaskContext&&t.webtaskContext.body?(t.body=t.webtaskContext.body,n()):e(t,r,n);return v.use(y(s.json())),v.use(y(s.urlencoded({extended:!1}))),v.use("/meta",f()),v.use("/.extensions",l()),v.use(p(g)),v.use(u.routes.dashboardAdmins({secret:d("EXTENSION_SECRET"),audience:"urn:logs-to-fluentd",rta:d("AUTH0_RTA").replace("https://",""),domain:d("AUTH0_DOMAIN"),baseUrl:d("PUBLIC_WT_URL")||d("WT_URL"),clientName:"Logs to Fluentd",urlPrefix:"",sessionStorageKey:"logs-to-fluentd:apiToken"})),v.use("/app",o.static(n.join(t,"../dist"))),v.use("/",c(g)),v.use(u.middlewares.errorHandler(h.error.bind(h))),v})}).call(t,"/")},function(e,t,r){const n=r(29),i=r(42),o=r(1),s=r(25);e.exports=function(e){if(!e||"object"!=typeof e)throw new o.ArgumentError("Must provide the options");if(null===e.secret||void 0===e.secret)throw new o.ArgumentError("Must provide a valid secret");if("string"!=typeof e.secret||0===e.secret.length)throw new o.ArgumentError("The provided secret is invalid: "+e.secret);if(null===e.audience||void 0===e.audience)throw new o.ArgumentError("Must provide a valid secret");if("string"!=typeof e.audience||0===e.audience.length)throw new o.ArgumentError("The provided audience is invalid: "+e.audience);if(null===e.baseUrl||void 0===e.baseUrl)throw new o.ArgumentError("Must provide a valid base URL");if("string"!=typeof e.baseUrl||0===e.baseUrl.length)throw new o.ArgumentError("The provided base URL is invalid: "+e.baseUrl);const t=i({audience:e.audience,issuer:e.baseUrl,secret:e.secret,algorithms:["HS256"],credentialsRequired:e.credentialsRequired||!0});return function(r,n,i){t(r,n,function(t){return t?i(t):e.onLoginSuccess?e.onLoginSuccess(r,n,i):i()})}},e.exports.optional=function(t){const r=e.exports(t);return s(function(e){if(e&&e.headers&&e.headers.authorization&&0===e.headers.authorization.indexOf("Bearer "))try{const r=n(e.headers.authorization.split(" ")[1]);return r&&r.iss===t.baseUrl}catch(e){return!1}return!1},r)}},function(e,t,r){const n=r(29),i=r(42),o=r(107),s=r(1),a=r(25),u=r(1).UnauthorizedError;e.exports=function(e){if(!e||"object"!=typeof e)throw new s.ArgumentError("Must provide the options");if(null===e.domain||void 0===e.domain)throw new s.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new s.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.audience||void 0===e.audience)throw new s.ArgumentError("Must provide a valid audience");if("string"!=typeof e.audience||0===e.audience.length)throw new s.ArgumentError("The provided audience is invalid: "+e.audience);const t=i({secret:o.expressJwtSecret({cache:!0,rateLimit:!0,jwksRequestsPerMinute:5,jwksUri:"https://"+e.domain+"/.well-known/jwks.json",handleSigningKeyError:function(e,t){return e instanceof o.SigningKeyNotFoundError?t(new u("A token was provided with an invalid kid")):t(e)}}),audience:e.audience,issuer:"https://"+e.domain+"/",algorithms:["RS256"],credentialsRequired:e&&e.credentialsRequired||!0});return function(r,n,i){t(r,n,function(t){return t?i(t):e.onLoginSuccess?e.onLoginSuccess(r,n,i):i()})}},e.exports.optional=function(t){const r=e.exports(t);return a(function(e){if(e&&e.headers&&e.headers.authorization&&0===e.headers.authorization.indexOf("Bearer "))try{const r=n(e.headers.authorization.split(" ")[1]);return r&&r.iss==="https://"+t.domain+"/"}catch(e){return!1}return!1},r)}},function(e,t,r){e.exports=function(e){return function(t,r,n,i){return e&&e(t),t&&t.status?(n.status(t.status),n.json({error:t.code||t.name,message:t.message||t.name})):(n.status(t.status||500),n.json({error:"InternalServerError",message:t.message||t.name}))}}},function(e,t,r){e.exports.authenticateAdmins=r(45),e.exports.authenticateUsers=r(46),e.exports.requireAuthentication=r(50),e.exports.errorHandler=r(47),e.exports.managementApiClient=r(49),e.exports.validateHookToken=r(51),e.exports.webtaskConfig=r(52)},function(e,t,r){const n=r(1);e.exports=function(e){return function(t,r,i){const o=t,s=t.user&&t.user.access_token&&t.user.access_token.length?{domain:e.domain,accessToken:t.user.access_token}:e;n.managementApi.getClient(s).then(function(e){return o.auth0=e,i(),null}).catch(function(e){i(e)})}}},function(e,t,r){const n=r(1).UnauthorizedError;e.exports=function(e,t,r){return e.user?r():r(new n("Authentication required for this endpoint."))}},function(e,t,r){const n=r(1);e.exports=function(e,t,r){if(null===e||void 0===e)throw new n.ArgumentError("Must provide the domain");if("string"!=typeof e||0===e.length)throw new n.ArgumentError("The provided domain is invalid: "+e);if(null===t||void 0===t)throw new n.ArgumentError("Must provide the webtaskUrl");if("string"!=typeof t||0===t.length)throw new n.ArgumentError("The provided webtaskUrl is invalid: "+t);if(null===r||void 0===r)throw new n.ArgumentError("Must provide the extensionSecret");if("string"!=typeof r||0===r.length)throw new n.ArgumentError("The provided extensionSecret is invalid: "+r);return function(i){if(null===i||void 0===i)throw new n.ArgumentError("Must provide the hookPath");if("string"!=typeof i||0===i.length)throw new n.ArgumentError("The provided hookPath is invalid: "+i);return function(o,s,a){if(o.headers.authorization&&"Bearer"===o.headers.authorization.split(" ")[0]){const s=o.headers.authorization.split(" ")[1];try{if(n.validateHookToken(e,t,i,r,s))return a()}catch(e){return a(e)}}return a(new n.HookTokenError("Hook token missing for the call to: "+i))}}}},function(e,t,r){const n=r(1);e.exports=function(e){return function(t,r,i){return t.webtaskContext&&e.setProvider(n.configProvider.fromWebtaskContext(t.webtaskContext)),i()}}},function(e,t,r){const n=r(5),i=r(40),o=r(56),s=r(106),a=r(1),u=r(23);e.exports=function(e){if(!e||"object"!=typeof e)throw new a.ArgumentError("Must provide the options");if(null===e.secret||void 0===e.secret)throw new a.ArgumentError("Must provide a valid secret");if("string"!=typeof e.secret||0===e.secret.length)throw new a.ArgumentError("The provided secret is invalid: "+e.secret);if(null===e.audience||void 0===e.audience)throw new a.ArgumentError("Must provide a valid audience");if("string"!=typeof e.audience||0===e.audience.length)throw new a.ArgumentError("The provided audience is invalid: "+e.audience);if(null===e.rta||void 0===e.rta)throw new a.ArgumentError("Must provide a valid rta");if("string"!=typeof e.rta||0===e.rta.length)throw new a.ArgumentError("The provided rta is invalid: "+e.rta);if(null===e.domain||void 0===e.domain)throw new a.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new a.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.baseUrl||void 0===e.baseUrl)throw new a.ArgumentError("Must provide a valid base URL");if("string"!=typeof e.baseUrl||0===e.baseUrl.length)throw new a.ArgumentError("The provided base URL is invalid: "+e.baseUrl);if(null===e.clientName||void 0===e.clientName)throw new a.ArgumentError("Must provide a valid client name");if("string"!=typeof e.clientName||0===e.clientName.length)throw new a.ArgumentError("The provided client name is invalid: "+e.clientName);const t=e.stateKey||"state",r=e.nonceKey||"nonce",c=e.urlPrefix||"",f=e.sessionStorageKey||"apiToken",l=n.Router();return l.get(c+"/login",function(n,o){const s=i.randomBytes(16).toString("hex"),f=i.randomBytes(16).toString("hex");o.cookie(t,s),o.cookie(r,f);const l=new a.SessionManager(e.rta,e.domain,e.baseUrl).createAuthorizeUrl({redirectUri:u.getBaseUrl(n)+c+"/login/callback",scopes:e.scopes,expiration:e.expiration,nonce:f,state:s});o.redirect(l)}),l.post(c+"/login/callback",o(),function(n,i,o){var c;try{c=s.decode(n.body.id_token)}catch(e){c=null}if(!c||!n.cookies||n.cookies[r]!==c.nonce)return o(new a.ValidationError("Login failed. Nonce mismatch."));if(!n.cookies||n.cookies[t]!==n.body.state)return o(new a.ValidationError("Login failed. State mismatch."));return new a.SessionManager(e.rta,e.domain,e.baseUrl).create(n.body.id_token,n.body.access_token,{secret:e.secret,issuer:e.baseUrl,audience:e.audience}).then(function(e){i.header("Content-Type","text/html"),i.status(200).send('<html><head><script type="text/javascript">sessionStorage.setItem("'+f+'", "'+e+'");window.location.href = "'+u.getBaseUrl(n)+'";<\/script></head></html>')}).catch(function(e){o(e)})}),l.get(c+"/logout",function(t,r){const n=encodeURIComponent(u.getBaseUrl(t));r.header("Content-Type","text/html"),r.status(200).send('<html><head><script type="text/javascript">sessionStorage.removeItem("'+f+'");window.location.href = "https://'+e.rta+"/v2/logout/?returnTo="+n+"&client_id="+n+'";<\/script></head></html>')}),l.get("/.well-known/oauth2-client-configuration",function(t,r){r.header("Content-Type","application/json"),r.status(200).send({redirect_uris:[u.getBaseUrl(t)+c+"/login/callback"],client_name:e.clientName,post_logout_redirect_uris:[u.getBaseUrl(t)]})}),l}},function(e,t,r){e.exports.dashboardAdmins=r(53)},function(e,t,r){const n=r(1),i=r(114);e.exports.createServer=function(e){const t=n.createServer(e);var r=null;return i.fromExpress(function(e,n){return r||(r=t(e.webtaskContext)),r(e,n)})}},function(e,t,r){"use strict";var n=r(57),i=r(103);function o(e){if("string"==typeof e&&"j:"===e.substr(0,2))try{return JSON.parse(e.slice(2))}catch(e){return}}function s(e){for(var t,r,n=Object.keys(e),i=0;i<n.length;i++)(r=o(e[t=n[i]]))&&(e[t]=r);return e}function a(e,t){if("string"==typeof e){if("s:"!==e.substr(0,2))return e;for(var r=!t||Array.isArray(t)?t||[]:[t],n=0;n<r.length;n++){var o=i.unsign(e.slice(2),r[n]);if(!1!==o)return o}return!1}}function u(e,t){for(var r,n,i,o=Object.keys(e),s=Object.create(null),u=0;u<o.length;u++)(i=e[n=o[u]])!==(r=a(i,t))&&(s[n]=r,delete e[n]);return s}e.exports=function(e,t){return function(r,i,o){if(r.cookies)return o();var a=r.headers.cookie,c=!e||Array.isArray(e)?e||[]:[e];if(r.secret=c[0],r.cookies=Object.create(null),r.signedCookies=Object.create(null),!a)return o();r.cookies=n.parse(a,t),0!==c.length&&(r.signedCookies=u(r.cookies,c),r.signedCookies=s(r.signedCookies)),r.cookies=s(r.cookies),o()}},e.exports.JSONCookie=o,e.exports.JSONCookies=s,e.exports.signedCookie=a,e.exports.signedCookies=u},function(e,t,r){"use strict";t.parse=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var r={},i=t||{},s=e.split(o),u=i.decode||n,c=0;c<s.length;c++){var f=s[c],l=f.indexOf("=");if(!(l<0)){var h=f.substr(0,l).trim(),d=f.substr(++l,f.length).trim();'"'==d[0]&&(d=d.slice(1,-1)),void 0==r[h]&&(r[h]=a(d,u))}}return r},t.serialize=function(e,t,r){var n=r||{},o=n.encode||i;if("function"!=typeof o)throw new TypeError("option encode is invalid");if(!s.test(e))throw new TypeError("argument name is invalid");var a=o(t);if(a&&!s.test(a))throw new TypeError("argument val is invalid");var u=e+"="+a;if(null!=n.maxAge){var c=n.maxAge-0;if(isNaN(c))throw new Error("maxAge should be a Number");u+="; Max-Age="+Math.floor(c)}if(n.domain){if(!s.test(n.domain))throw new TypeError("option domain is invalid");u+="; Domain="+n.domain}if(n.path){if(!s.test(n.path))throw new TypeError("option path is invalid");u+="; Path="+n.path}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");u+="; Expires="+n.expires.toUTCString()}n.httpOnly&&(u+="; HttpOnly");n.secure&&(u+="; Secure");if(n.sameSite){var f="string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite;switch(f){case!0:u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"strict":u+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return u};var n=decodeURIComponent,i=encodeURIComponent,o=/; */,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function a(e,t){try{return t(e)}catch(t){return e}}},function(e,t,r){"use strict";const n=r(27),i=r(26);let o=new n("debug");e.exports={configure:function(t,r){o.end(),(o=new n(t,r))._setupErrorHandler(),e.exports.emit=o.emit.bind(o)},createFluentSender:function(e,t){const r=new n(e,t);return r._setupErrorHandler(),r},support:{winstonTransport:function(){return r(60)}},EventTime:i};["end","addListener","on","once","removeListener","removeAllListeners","setMaxListeners","getMaxListeners"].forEach((t,r)=>{e.exports[t]=function(){if(o)return o[t].apply(o,arguments)}}),e.exports.emit=o.emit.bind(o)},function(e,t,r){"use strict";e.exports={};class n extends Error{constructor(e,t){super(),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e,this.options=t}}e.exports={ConfigError:class extends n{constructor(e,t){super(e,t)}},MissingTag:class extends n{constructor(e,t){super(e,t)}},ResponseError:class extends n{constructor(e,t){super(e,t)}},DataTypeError:class extends n{constructor(e,t){super(e,t)}},ResponseTimeout:class extends n{constructor(e,t){super(e,t)}},HandshakeError:class extends n{constructor(e,t){super(e,t)}}}},function(e,t,r){"use strict";const n=r(27),i=r(89);e.exports=class extends i{constructor(e="winston",t={}){const r="object"==typeof e,i="string"==typeof e?e:r?e.tag||"winston":null,o=r?e:t||{};super(o),this.name="fluent",this.sender=new n(i,o),this.sender._setupErrorHandler()}log(e,t){setImmediate(()=>{this.sender.emit(e,r=>{r?(this.emit("error",e),t&&t(r,!1)):(this.emit("logged",e),t&&t(null,!0))})})}}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){e.exports={title:"Auth0 Logs to Fluentd",name:"auth0-logs-to-fluentd",version:"1.0.0",preVersion:"1.0.0",author:"goabout",category:"log_export",description:"This extension will continuously export your Auth0 logs to Fluentd",type:"cron",initialUrlPath:"/login",repository:"https://github.com/goabout/auth0-logs-to-fluentd",docsUrl:"https://github.com/goabout/auth0-logs-to-fluentd",logoUrl:"https://avatars1.githubusercontent.com/u/859518",keywords:["auth0","extension"],schedule:"0 */5 * * * *",auth0:{createClient:!0,onUninstallPath:"/.extensions/on-uninstall",scopes:"read:logs delete:clients"},secrets:{BATCH_SIZE:{description:"The amount of logs to batch before sending to Fluentd. A single cron execution will send multiple batches.",default:100},FLUENTD_HOST:{description:"Fluentd host",example:"example.com",required:!0},FLUENTD_PORT:{description:"Fluentd port",example:"24224",required:!0},FLUENTD_TLS:{description:"This setting will enable TLS for the connection to Fluentd",type:"select",allowMultiple:!1,default:"false",options:[{value:"false",text:"No"},{value:"true",text:"Yes"}]},FLUENTD_SHARED_KEY:{description:"Fluentd shared key(optional)",type:"password"},START_FROM:{description:"Checkpoint ID of log to start from."},SLACK_INCOMING_WEBHOOK_URL:{description:"Slack Incoming Webhook URL used to report statistics and possible failures"},SLACK_SEND_SUCCESS:{description:"This setting will enable verbose notifications to Slack which are useful for troubleshooting",type:"select",allowMultiple:!1,default:"false",options:[{value:"false",text:"No"},{value:"true",text:"Yes"}]},LOG_LEVEL:{description:"This allows you to specify the log level of events that need to be sent",type:"select",allowMultiple:!0,options:[{value:"-",text:""},{value:"0",text:"Debug"},{value:"1",text:"Info"},{value:"2",text:"Warning"},{value:"3",text:"Error"},{value:"4",text:"Critical"}]},LOG_TYPES:{description:"If you only want to send events with a specific type (eg: failed logins)",type:"select",allowMultiple:!0,options:[{text:"",value:"-"},{text:"Success Login",value:"s"},{text:"Success Exchange",value:"seacft"},{text:"Success Exchange (Client Credentials)",value:"seccft"},{text:"Failed Exchange",value:"feacft"},{text:"Failed Exchange (Client Credentials)",value:"feccft"},{text:"Failed Login",value:"f"},{text:"Warnings During Login",value:"w"},{text:"Deleted User",value:"du"},{text:"Failed Login (invalid email/username)",value:"fu"},{text:"Failed Login (wrong password)",value:"fp"},{text:"Failed by Connector",value:"fc"},{text:"Failed by CORS",value:"fco"},{text:"Connector Online",value:"con"},{text:"Connector Offline",value:"coff"},{text:"Failed Connector Provisioning",value:"fcpro"},{text:"Success Signup",value:"ss"},{text:"Failed Signup",value:"fs"},{text:"Code Sent",value:"cs"},{text:"Code/Link Sent",value:"cls"},{text:"Success Verification Email",value:"sv"},{text:"Failed Verification Email",value:"fv"},{text:"Success Change Password",value:"scp"},{text:"Failed Change Password",value:"fcp"},{text:"Success Change Email",value:"sce"},{text:"Failed Change Email",value:"fce"},{text:"Success Change Username",value:"scu"},{text:"Failed Change Username",value:"fcu"},{text:"Success Change Phone Number",value:"scpn"},{text:"Failed Change Phone Number",value:"fcpn"},{text:"Success Verification Email Request",value:"svr"},{text:"Failed Verification Email Request",value:"fvr"},{text:"Success Change Password Request",value:"scpr"},{text:"Failed Change Password Request",value:"fcpr"},{text:"Failed Sending Notification",value:"fn"},{text:"API Operation",value:"sapi"},{text:"Failed API Operation",value:"fapi"},{text:"Blocked Account",value:"limit_wc"},{text:"Too Many Calls to /userinfo",value:"limit_ui"},{text:"Rate Limit On API",value:"api_limit"},{text:"Successful User Deletion",value:"sdu"},{text:"Failed User Deletion",value:"fdu"},{text:"Blocked Account",value:"limit_wc"},{text:"Blocked IP Address",value:"limit_mu"},{text:"Success Logout",value:"slo"},{text:"Failed Logout",value:"flo"},{text:"Success Delegation",value:"sd"},{text:"Failed Delegation",value:"fd"}]}}}},function(e,t){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(e){this.message=e}n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,o,s=0,a=0,u="";o=t.charAt(a++);~o&&(i=s%4?64*i+o:o,s++%4)?u+=String.fromCharCode(255&i>>(-2*s&6)):0)o=r.indexOf(o);return u}},function(e,t,r){var n=r(63);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(n(e).replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(t)}catch(e){return n(t)}}},function(e,t,r){t.encode=r(31).encode,t.decode=r(30).decode,t.Encoder=r(75).Encoder,t.Decoder=r(73).Decoder,t.createEncodeStream=r(74).createEncodeStream,t.createDecodeStream=r(72).createDecodeStream,t.createCodec=r(78).createCodec,t.codec=r(71).codec},function(e,t){function r(e){return e&&e.isBuffer&&e}e.exports=r("undefined"!=typeof Buffer&&Buffer)||r(this.Buffer)||r("undefined"!=typeof window&&window.Buffer)||this.Buffer},function(e,t){t.copy=function(e,t,r,n){var i;r||(r=0);n||0===n||(n=this.length);t||(t=0);var o=n-r;if(e===this&&r<t&&t<n)for(i=o-1;i>=0;i--)e[i+t]=this[i+r];else for(i=0;i<o;i++)e[i+t]=this[i+r];return o},t.toString=function(e,t,r){var n=0|t;r||(r=this.length);var i="",o=0;for(;n<r;)(o=this[n++])<128?i+=String.fromCharCode(o):(192==(224&o)?o=(31&o)<<6|63&this[n++]:224==(240&o)?o=(15&o)<<12|(63&this[n++])<<6|63&this[n++]:240==(248&o)&&(o=(7&o)<<18|(63&this[n++])<<12|(63&this[n++])<<6|63&this[n++]),o>=65536?(o-=65536,i+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):i+=String.fromCharCode(o));return i},t.write=function(e,t){var r=t||(t|=0),n=e.length,i=0,o=0;for(;o<n;)(i=e.charCodeAt(o++))<128?this[r++]=i:i<2048?(this[r++]=192|i>>>6,this[r++]=128|63&i):i<55296||i>57343?(this[r++]=224|i>>>12,this[r++]=128|i>>>6&63,this[r++]=128|63&i):(i=65536+(i-55296<<10|e.charCodeAt(o++)-56320),this[r++]=240|i>>>18,this[r++]=128|i>>>12&63,this[r++]=128|i>>>6&63,this[r++]=128|63&i);return r-t}},function(e,t,r){var n=r(0);function i(e){return new Array(e)}(t=e.exports=i(0)).alloc=i,t.concat=n.concat,t.from=function(e){if(!n.isBuffer(e)&&n.isView(e))e=n.Uint8Array.from(e);else if(n.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return n.from.call(t,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(e)}},function(e,t,r){var n=r(0),i=n.global;function o(e){return new i(e)}(t=e.exports=n.hasBuffer?o(0):[]).alloc=n.hasBuffer&&i.alloc||o,t.concat=n.concat,t.from=function(e){if(!n.isBuffer(e)&&n.isView(e))e=n.Uint8Array.from(e);else if(n.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return n.from.call(t,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return i.from&&1!==i.from.length?i.from(e):new i(e)}},function(e,t,r){var n=r(0);function i(e){return new Uint8Array(e)}(t=e.exports=n.hasArrayBuffer?i(0):[]).alloc=i,t.concat=n.concat,t.from=function(e){if(n.isView(e)){var r=e.byteOffset,i=e.byteLength;(e=e.buffer).byteLength!==i&&(e.slice?e=e.slice(r,r+i):(e=new Uint8Array(e)).byteLength!==i&&(e=Array.prototype.slice.call(e,r,r+i)))}else{if("string"==typeof e)return n.from.call(t,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(e)}},function(e,t,r){r(18),r(19),t.codec={preset:r(9).preset}},function(e,t,r){t.createDecodeStream=a;var n=r(2),i=r(6).Transform,o=r(15).DecodeBuffer;n.inherits(a,i);var s={objectMode:!0};function a(e){if(!(this instanceof a))return new a(e);e?e.objectMode=!0:e=s,i.call(this,e);var t=this;(this.decoder=new o(e)).push=function(e){t.push(e)}}a.prototype._transform=function(e,t,r){this.decoder.write(e),this.decoder.flush(),r&&r()}},function(e,t,r){t.Decoder=o;var n=r(24),i=r(15).DecodeBuffer;function o(e){if(!(this instanceof o))return new o(e);i.call(this,e)}o.prototype=new i,n.mixin(o.prototype),o.prototype.decode=function(e){arguments.length&&this.write(e),this.flush()},o.prototype.push=function(e){this.emit("data",e)},o.prototype.end=function(e){this.decode(e),this.emit("end")}},function(e,t,r){t.createEncodeStream=a;var n=r(2),i=r(6).Transform,o=r(16).EncodeBuffer;n.inherits(a,i);var s={objectMode:!0};function a(e){if(!(this instanceof a))return new a(e);e?e.objectMode=!0:e=s,i.call(this,e);var t=this;(this.encoder=new o(e)).push=function(e){t.push(e)}}a.prototype._transform=function(e,t,r){this.encoder.write(e),r&&r()},a.prototype._flush=function(e){this.encoder.flush(),e&&e()}},function(e,t,r){t.Encoder=o;var n=r(24),i=r(16).EncodeBuffer;function o(e){if(!(this instanceof o))return new o(e);i.call(this,e)}o.prototype=new i,n.mixin(o.prototype),o.prototype.encode=function(e){this.write(e),this.emit("data",this.read())},o.prototype.end=function(e){arguments.length&&this.encode(e),this.flush(),this.emit("end")}},function(e,t,r){t.setExtPackers=function(e){e.addExtPacker(14,Error,[l,u]),e.addExtPacker(1,EvalError,[l,u]),e.addExtPacker(2,RangeError,[l,u]),e.addExtPacker(3,ReferenceError,[l,u]),e.addExtPacker(4,SyntaxError,[l,u]),e.addExtPacker(5,TypeError,[l,u]),e.addExtPacker(6,URIError,[l,u]),e.addExtPacker(10,RegExp,[f,u]),e.addExtPacker(11,Boolean,[c,u]),e.addExtPacker(12,String,[c,u]),e.addExtPacker(13,Date,[Number,u]),e.addExtPacker(15,Number,[c,u]),"undefined"!=typeof Uint8Array&&(e.addExtPacker(17,Int8Array,s),e.addExtPacker(18,Uint8Array,s),e.addExtPacker(19,Int16Array,s),e.addExtPacker(20,Uint16Array,s),e.addExtPacker(21,Int32Array,s),e.addExtPacker(22,Uint32Array,s),e.addExtPacker(23,Float32Array,s),"undefined"!=typeof Float64Array&&e.addExtPacker(24,Float64Array,s),"undefined"!=typeof Uint8ClampedArray&&e.addExtPacker(25,Uint8ClampedArray,s),e.addExtPacker(26,ArrayBuffer,s),e.addExtPacker(29,DataView,s));i.hasBuffer&&e.addExtPacker(27,o,i.from)};var n,i=r(0),o=i.global,s=i.Uint8Array.from,a={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function u(e){return n||(n=r(31).encode),n(e)}function c(e){return e.valueOf()}function f(e){(e=RegExp.prototype.toString.call(e).split("/")).shift();var t=[e.pop()];return t.unshift(e.join("/")),t}function l(e){var t={};for(var r in a)t[r]=e[r];return t}},function(e,t,r){t.setExtUnpackers=function(e){e.addExtUnpacker(14,[a,c(Error)]),e.addExtUnpacker(1,[a,c(EvalError)]),e.addExtUnpacker(2,[a,c(RangeError)]),e.addExtUnpacker(3,[a,c(ReferenceError)]),e.addExtUnpacker(4,[a,c(SyntaxError)]),e.addExtUnpacker(5,[a,c(TypeError)]),e.addExtUnpacker(6,[a,c(URIError)]),e.addExtUnpacker(10,[a,u]),e.addExtUnpacker(11,[a,f(Boolean)]),e.addExtUnpacker(12,[a,f(String)]),e.addExtUnpacker(13,[a,f(Date)]),e.addExtUnpacker(15,[a,f(Number)]),"undefined"!=typeof Uint8Array&&(e.addExtUnpacker(17,f(Int8Array)),e.addExtUnpacker(18,f(Uint8Array)),e.addExtUnpacker(19,[l,f(Int16Array)]),e.addExtUnpacker(20,[l,f(Uint16Array)]),e.addExtUnpacker(21,[l,f(Int32Array)]),e.addExtUnpacker(22,[l,f(Uint32Array)]),e.addExtUnpacker(23,[l,f(Float32Array)]),"undefined"!=typeof Float64Array&&e.addExtUnpacker(24,[l,f(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&e.addExtUnpacker(25,f(Uint8ClampedArray)),e.addExtUnpacker(26,l),e.addExtUnpacker(29,[l,f(DataView)]));i.hasBuffer&&e.addExtUnpacker(27,f(o))};var n,i=r(0),o=i.global,s={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function a(e){return n||(n=r(30).decode),n(e)}function u(e){return RegExp.apply(null,e)}function c(e){return function(t){var r=new e;for(var n in s)r[n]=t[n];return r}}function f(e){return function(t){return new e(t)}}function l(e){return new Uint8Array(e).buffer}},function(e,t,r){r(18),r(19),t.createCodec=r(9).createCodec},function(e,t,r){var n=r(33);function i(e){var t,r=new Array(256);for(t=0;t<=127;t++)r[t]=o(t);for(t=128;t<=143;t++)r[t]=a(t-128,e.map);for(t=144;t<=159;t++)r[t]=a(t-144,e.array);for(t=160;t<=191;t++)r[t]=a(t-160,e.str);for(r[192]=o(null),r[193]=null,r[194]=o(!1),r[195]=o(!0),r[196]=s(e.uint8,e.bin),r[197]=s(e.uint16,e.bin),r[198]=s(e.uint32,e.bin),r[199]=s(e.uint8,e.ext),r[200]=s(e.uint16,e.ext),r[201]=s(e.uint32,e.ext),r[202]=e.float32,r[203]=e.float64,r[204]=e.uint8,r[205]=e.uint16,r[206]=e.uint32,r[207]=e.uint64,r[208]=e.int8,r[209]=e.int16,r[210]=e.int32,r[211]=e.int64,r[212]=a(1,e.ext),r[213]=a(2,e.ext),r[214]=a(4,e.ext),r[215]=a(8,e.ext),r[216]=a(16,e.ext),r[217]=s(e.uint8,e.str),r[218]=s(e.uint16,e.str),r[219]=s(e.uint32,e.str),r[220]=s(e.uint16,e.array),r[221]=s(e.uint32,e.array),r[222]=s(e.uint16,e.map),r[223]=s(e.uint32,e.map),t=224;t<=255;t++)r[t]=o(t-256);return r}function o(e){return function(){return e}}function s(e,t){return function(r){var n=e(r);return t(r,n)}}function a(e,t){return function(r){return t(r,e)}}t.getReadToken=function(e){var t=n.getReadFormat(e);return e&&e.useraw?function(e){var t,r=i(e).slice();for(r[217]=r[196],r[218]=r[197],r[219]=r[198],t=160;t<=191;t++)r[t]=a(t-160,e.bin);return r}(t):i(t)}},function(e,t,r){var n=r(28),i=r(13),o=i.Uint64BE,s=i.Int64BE,a=r(34).uint8,u=r(0),c=u.global,f=u.hasBuffer&&"TYPED_ARRAY_SUPPORT"in c&&!c.TYPED_ARRAY_SUPPORT,l=u.hasBuffer&&c.prototype||{};function h(){var e=a.slice();return e[196]=d(196),e[197]=p(197),e[198]=g(198),e[199]=d(199),e[200]=p(200),e[201]=g(201),e[202]=v(202,4,l.writeFloatBE||w,!0),e[203]=v(203,8,l.writeDoubleBE||b,!0),e[204]=d(204),e[205]=p(205),e[206]=g(206),e[207]=v(207,8,y),e[208]=d(208),e[209]=p(209),e[210]=g(210),e[211]=v(211,8,m),e[217]=d(217),e[218]=p(218),e[219]=g(219),e[220]=p(220),e[221]=g(221),e[222]=p(222),e[223]=g(223),e}function d(e){return function(t,r){var n=t.reserve(2),i=t.buffer;i[n++]=e,i[n]=r}}function p(e){return function(t,r){var n=t.reserve(3),i=t.buffer;i[n++]=e,i[n++]=r>>>8,i[n]=r}}function g(e){return function(t,r){var n=t.reserve(5),i=t.buffer;i[n++]=e,i[n++]=r>>>24,i[n++]=r>>>16,i[n++]=r>>>8,i[n]=r}}function v(e,t,r,n){return function(i,o){var s=i.reserve(t+1);i.buffer[s++]=e,r.call(i.buffer,o,s,n)}}function y(e,t){new o(this,t,e)}function m(e,t){new s(this,t,e)}function w(e,t){n.write(this,e,t,!1,23,4)}function b(e,t){n.write(this,e,t,!1,52,8)}t.getWriteToken=function(e){return e&&e.uint8array?((t=h())[202]=v(202,4,w),t[203]=v(203,8,b),t):f||u.hasBuffer&&e&&e.safe?function(){var e=a.slice();return e[196]=v(196,1,c.prototype.writeUInt8),e[197]=v(197,2,c.prototype.writeUInt16BE),e[198]=v(198,4,c.prototype.writeUInt32BE),e[199]=v(199,1,c.prototype.writeUInt8),e[200]=v(200,2,c.prototype.writeUInt16BE),e[201]=v(201,4,c.prototype.writeUInt32BE),e[202]=v(202,4,c.prototype.writeFloatBE),e[203]=v(203,8,c.prototype.writeDoubleBE),e[204]=v(204,1,c.prototype.writeUInt8),e[205]=v(205,2,c.prototype.writeUInt16BE),e[206]=v(206,4,c.prototype.writeUInt32BE),e[207]=v(207,8,y),e[208]=v(208,1,c.prototype.writeInt8),e[209]=v(209,2,c.prototype.writeInt16BE),e[210]=v(210,4,c.prototype.writeInt32BE),e[211]=v(211,8,m),e[217]=v(217,1,c.prototype.writeUInt8),e[218]=v(218,2,c.prototype.writeUInt16BE),e[219]=v(219,4,c.prototype.writeUInt32BE),e[220]=v(220,2,c.prototype.writeUInt16BE),e[221]=v(221,4,c.prototype.writeUInt32BE),e[222]=v(222,2,c.prototype.writeUInt16BE),e[223]=v(223,4,c.prototype.writeUInt32BE),e}():h();var t}},function(e,t,r){var n=r(8),i=r(13),o=i.Uint64BE,s=i.Int64BE,a=r(0),u=r(14),c=r(80),f=r(34).uint8,l=r(17).ExtBuffer,h="undefined"!=typeof Uint8Array,d="undefined"!=typeof Map,p=[];p[1]=212,p[2]=213,p[4]=214,p[8]=215,p[16]=216,t.getWriteType=function(e){var t=c.getWriteToken(e),r=e&&e.useraw,i=h&&e&&e.binarraybuffer,g=i?a.isArrayBuffer:a.isBuffer,v=i?function(e,t){b(e,new Uint8Array(t))}:b,y=d&&e&&e.usemap?function(e,r){if(!(r instanceof Map))return x(e,r);var n=r.size;t[n<16?128+n:n<=65535?222:223](e,n);var i=e.codec.encode;r.forEach(function(t,r,n){i(e,r),i(e,t)})}:x;return{boolean:function(e,r){t[r?195:194](e,r)},function:w,number:function(e,r){var n,i=0|r;if(r!==i)return void t[n=203](e,r);n=-32<=i&&i<=127?255&i:0<=i?i<=255?204:i<=65535?205:206:-128<=i?208:-32768<=i?209:210;t[n](e,i)},object:r?function(e,r){if(g(r))return function(e,r){var n=r.length;t[n<32?160+n:n<=65535?218:219](e,n),e.send(r)}(e,r);m(e,r)}:m,string:function(e){return function(r,n){var i=n.length,o=5+3*i;r.offset=r.reserve(o);var s=r.buffer,a=e(i),c=r.offset+a;i=u.write.call(s,n,c);var f=e(i);if(a!==f){var l=c+f-a,h=c+i;u.copy.call(s,s,l,c,h)}t[1===f?160+i:f<=3?215+f:219](r,i),r.offset+=i}}(r?function(e){return e<32?1:e<=65535?3:5}:function(e){return e<32?1:e<=255?2:e<=65535?3:5}),symbol:w,undefined:w};function m(e,r){if(null===r)return w(e,r);if(g(r))return v(e,r);if(n(r))return function(e,r){var n=r.length;t[n<16?144+n:n<=65535?220:221](e,n);for(var i=e.codec.encode,o=0;o<n;o++)i(e,r[o])}(e,r);if(o.isUint64BE(r))return function(e,r){t[207](e,r.toArray())}(e,r);if(s.isInt64BE(r))return function(e,r){t[211](e,r.toArray())}(e,r);var i=e.codec.getExtPacker(r);if(i&&(r=i(r)),r instanceof l)return function(e,r){var n=r.buffer,i=n.length,o=p[i]||(i<255?199:i<=65535?200:201);t[o](e,i),f[r.type](e),e.send(n)}(e,r);y(e,r)}function w(e,r){t[192](e,r)}function b(e,r){var n=r.length,i=n<255?196:n<=65535?197:198;t[i](e,n),e.send(r)}function x(e,r){var n=Object.keys(r),i=n.length,o=i<16?128+i:i<=65535?222:223;t[o](e,i);var s=e.codec.encode;n.forEach(function(t){s(e,t),s(e,r[t])})}}},function(e,t,r){var n=r(116);function i(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function o(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}e.exports=n(i),e.exports.strict=n(o),i.proto=i(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})})},function(e,t,r){"use strict";t.levels={error:0,warn:1,help:2,data:3,info:4,debug:5,prompt:6,verbose:7,input:8,silly:9},t.colors={error:"red",warn:"yellow",help:"cyan",data:"grey",info:"green",debug:"blue",prompt:"grey",verbose:"cyan",input:"grey",silly:"magenta"}},function(e,t,r){"use strict";Object.defineProperty(t,"cli",{value:r(83)}),Object.defineProperty(t,"npm",{value:r(85)}),Object.defineProperty(t,"syslog",{value:r(86)})},function(e,t,r){"use strict";t.levels={error:0,warn:1,info:2,http:3,verbose:4,debug:5,silly:6},t.colors={error:"red",warn:"yellow",info:"green",http:"green",verbose:"cyan",debug:"blue",silly:"magenta"}},function(e,t,r){"use strict";t.levels={emerg:0,alert:1,crit:2,error:3,warning:4,notice:5,info:6,debug:7},t.colors={emerg:"red",alert:"yellow",crit:"red",error:"red",warning:"red",notice:"yellow",info:"green",debug:"blue"}},function(e,t,r){"use strict";Object.defineProperty(t,"LEVEL",{value:Symbol.for("level")}),Object.defineProperty(t,"MESSAGE",{value:Symbol.for("message")}),Object.defineProperty(t,"SPLAT",{value:Symbol.for("splat")}),Object.defineProperty(t,"configs",{value:r(84)})},function(e,t,r){e.exports=r(2).deprecate},function(e,t,r){"use strict";const n=r(2),i=r(92),{LEVEL:o}=r(87),s=e.exports=function(e={}){i.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this.format=e.format,this.level=e.level,this.handleExceptions=e.handleExceptions,this.silent=e.silent,e.log&&(this.log=e.log),e.logv&&(this.logv=e.logv),e.close&&(this.close=e.close),this.once("pipe",e=>{this.levels=e.levels,this.parent=e}),this.once("unpipe",e=>{e===this.parent&&(this.parent=null,this.close&&this.close())})};n.inherits(s,i),s.prototype._write=function(e,t,r){if(this.silent||!0===e.exception&&!this.handleExceptions)return r(null);const n=this.level||this.parent&&this.parent.level;if(!n||this.levels[n]>=this.levels[e[o]]){if(e&&!this.format)return this.log(e,r);let t,n;try{n=this.format.transform(Object.assign({},e),this.format.options)}catch(e){t=e}if(t||!n){if(r(),t)throw t;return}return this.log(n,r)}return r(null)},s.prototype._writev=function(e,t){if(this.logv){const r=e.filter(this._accept,this);return r.length?this.logv(r,t):t(null)}for(let r=0;r<e.length;r++){if(!this._accept(e[r]))continue;if(e[r].chunk&&!this.format){this.log(e[r].chunk,e[r].callback);continue}let n,i;try{i=this.format.transform(Object.assign({},e[r].chunk),this.format.options)}catch(e){n=e}if(n||!i){if(e[r].callback(),n)throw t(null),n}else this.log(i,e[r].callback)}return t(null)},s.prototype._accept=function(e){const t=e.chunk;if(this.silent)return!1;const r=this.level||this.parent&&this.parent.level;return!(!0!==t.exception&&r&&!(this.levels[r]>=this.levels[t[o]])||!this.handleExceptions&&!0===t.exception)},s.prototype._nop=function(){}},function(e,t,r){"use strict";var n=r(10);e.exports=m;var i,o=r(8);m.ReadableState=y;r(41).EventEmitter;var s=function(e,t){return e.listeners(t).length},a=r(37),u=r(20).Buffer,c=global.Uint8Array||function(){};var f=r(21);f.inherits=r(12);var l=r(2),h=void 0;h=l&&l.debuglog?l.debuglog("stream"):function(){};var d,p=r(91),g=r(36);f.inherits(m,a);var v=["error","close","destroy","pause","resume"];function y(e,t){i=i||r(11),e=e||{};var n=t instanceof i;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var o=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:n&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(d||(d=r(38).StringDecoder),this.decoder=new d(e.encoding),this.encoding=e.encoding)}function m(e){if(i=i||r(11),!(this instanceof m))return new m(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function w(e,t,r,n,i){var o,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,_(e)}(e,s)):(i||(o=function(e,t){var r;n=t,u.isBuffer(n)||n instanceof c||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),n?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):b(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?b(e,s,t,!1):S(e,s)):b(e,s,t,!1))):n||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function b(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&_(e)),S(e,t)}Object.defineProperty(m.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),m.prototype.destroy=g.destroy,m.prototype._undestroy=g.undestroy,m.prototype._destroy=function(e,t){this.push(null),t(e)},m.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),r=!0),w(this,e,t,!1,r)},m.prototype.unshift=function(e){return w(this,e,null,!0,!1)},m.prototype.isPaused=function(){return!1===this._readableState.flowing},m.prototype.setEncoding=function(e){return d||(d=r(38).StringDecoder),this._readableState.decoder=new d(e),this._readableState.encoding=e,this};var x=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=x?e=x:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function _(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n.nextTick(k,e):k(e))}function k(e){h("emit readable"),e.emit("readable"),C(e)}function S(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(T,e,t))}function T(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function A(e){h("readable nexttick read 0"),e.read(0)}function U(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}function C(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function M(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=u.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,s),0===(e-=s)){s===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function B(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,n.nextTick(L,t,e))}function L(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function R(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}m.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?B(this):_(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&B(this),null;var n,i=t.needReadable;return h("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",i=!0),t.ended||t.reading?h("reading or ended",i=!1):i&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(r,t))),null===(n=e>0?M(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&B(this)),null!==n&&this.emit("data",n),n},m.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},m.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,h("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?c:m;function u(t,n){h("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,h("cleanup"),e.removeListener("close",v),e.removeListener("finish",y),e.removeListener("drain",f),e.removeListener("error",g),e.removeListener("unpipe",u),r.removeListener("end",c),r.removeListener("end",m),r.removeListener("data",p),l=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||f())}function c(){h("onend"),e.end()}i.endEmitted?n.nextTick(a):r.once("end",a),e.on("unpipe",u);var f=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,C(e))}}(r);e.on("drain",f);var l=!1;var d=!1;function p(t){h("ondata"),d=!1,!1!==e.write(t)||d||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==R(i.pipes,e))&&!l&&(h("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,d=!0),r.pause())}function g(t){h("onerror",t),m(),e.removeListener("error",g),0===s(e,"error")&&e.emit("error",t)}function v(){e.removeListener("finish",y),m()}function y(){h("onfinish"),e.removeListener("close",v),m()}function m(){h("unpipe"),r.unpipe(e)}return r.on("data",p),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",g),e.once("close",v),e.once("finish",y),e.emit("pipe",r),i.flowing||(h("pipe resume"),r.resume()),e},m.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var s=R(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},m.prototype.on=function(e,t){var r=a.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&_(this):n.nextTick(A,this))}return r},m.prototype.addListener=m.prototype.on,m.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(U,e,t))}(this,e)),this},m.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},m.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(h("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){(h("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&void 0!==i)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<v.length;o++)e.on(v[o],this.emit.bind(this,v[o]));return this._read=function(t){h("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(m.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),m._fromList=M},function(e,t,r){"use strict";var n=r(20).Buffer,i=r(2);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,o=n.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,r=o,i=a,t.copy(r,i),a+=s.data.length,s=s.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t,r){var n=r(6),i=r(35);"disable"===r.i({NODE_ENV:"production",CLIENT_VERSION:"1.0.0"}).READABLE_STREAM?e.exports=n&&n.Writable||i:e.exports=i},function(e,t,r){var n=r(39),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){const n=r(100),i=(r(112),r(109)),o=(r(22),r(58)),s=(o.EventTime,r(101)),a=r(3),u=r(7);e.exports=(e=>(t,r,c)=>{const f=t.webtaskContext&&t.webtaskContext.body||t.body||{},l=t.webtaskContext&&t.webtaskContext.headers||{};if(!(f.schedule&&"active"===f.state||l.referer===`${a("AUTH0_MANAGE_URL")}/`&&l["if-none-match"]))return c();const h={host:a("FLUENTD_HOST"),port:a("FLUENTD_PORT"),security:{},timeout:3,tls:"true"===a("FLUENTD_TLS")},d=a("FLUENTD_SHARED_KEY");d&&(h.security.sharedKey=d),o.configure("auth0",h);const p=Date.now(),g=function(e,t){if(!e)return t();const r={post_date:p,type_description:s.logTypes.get(e.type)};Object.keys(e).forEach(t=>{r[t]=e[t]}),o.emit(r,t)},v=new s.reporters.SlackReporter({hook:a("SLACK_INCOMING_WEBHOOK_URL"),username:"auth0-logs-to-fluentd",title:"Logs To Fluentd"}),y={domain:a("AUTH0_DOMAIN"),clientId:a("AUTH0_CLIENT_ID"),clientSecret:a("AUTH0_CLIENT_SECRET"),batchSize:parseInt(a("BATCH_SIZE"),10),startFrom:a("START_FROM"),logTypes:a("LOG_TYPES"),logLevel:a("LOG_LEVEL")};(!y.batchSize||y.batchSize>100)&&(y.batchSize=100),y.logTypes&&!Array.isArray(y.logTypes)&&(y.logTypes=y.logTypes.replace(/\s/g,"").split(","));const m=new s.LogsProcessor(e,y),w=()=>{e.read().then(t=>{const r=i().format("DD-MM-YYYY"),n=a("DAILY_REPORT_TIME")||16;t.lastReportDate!==r&&(new Date).getHours()>=n&&(t=>{const r=(new Date).getTime(),n=r-864e5;m.getReport(n,r).then(e=>v.send(e,e.checkpoint)).then(()=>e.read()).then(r=>(r.lastReportDate=t,e.write(r)))})(r)})};return m.run((e,t)=>{if(!e||!e.length)return t();u.info(`Sending ${e.length} logs to Fluentd.`),n.eachLimit(e,10,g,t)}).then(e=>{e&&e.status&&e.status.error?v.send(e.status,e.checkpoint):!0!==a("SLACK_SEND_SUCCESS")&&"true"!==a("SLACK_SEND_SUCCESS")||v.send(e.status,e.checkpoint),w(),r.json(e)}).catch(e=>{v.send({error:e,logsProcessed:0},null),w(),c(e)})})},function(e,t,r){const n=r(5).Router,i=r(4).middlewares,o=r(3),s=r(7);e.exports=(()=>{const e=n(),t=i.validateHookToken(o("AUTH0_DOMAIN"),o("WT_URL"),o("EXTENSION_SECRET"));return e.use("/on-uninstall",t("/.extensions/on-uninstall")),e.use(i.managementApiClient({domain:o("AUTH0_DOMAIN"),clientId:o("AUTH0_CLIENT_ID"),clientSecret:o("AUTH0_CLIENT_SECRET")})),e.delete("/on-uninstall",(e,t)=>{const r=o("AUTH0_CLIENT_ID");e.auth0.clients.delete({client_id:r}).then(()=>{s.debug(`Deleted client ${r}`),t.sendStatus(204)}).catch(e=>{s.debug(`Error deleting client: ${o("AUTH0_CLIENT_ID")}`),s.error(e),t.sendStatus(204)})}),e})},function(e,t,r){(function(t){r(105);const n=r(104),i=(r(43),r(4).urlHelpers),o=r(3);e.exports=(()=>{const e='\n  <!DOCTYPE html>\n  <html lang="en">\n  <head>\n    <title><%= config.TITLE %></title>\n    <meta charset="UTF-8" />\n    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/4.6.13/lib/logos/img/favicon.png">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.1672/css/index.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/4.6.13/index.min.css" />\n    <% if (assets.style) { %><link rel="stylesheet" type="text/css" href="/app/<%= assets.style %>" /><% } %>\n    <% if (assets.version) { %><link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-logs-to-fluentd/assets/auth0-logs-to-fluentd.ui.<%= assets.version %>.css" /><% } %>\n    <% if (assets.customCss) { %><link rel="stylesheet" type="text/css" href="<%= assets.customCss %>" /><% } %>\n  </head>\n  <body>\n    <div id="app"></div>\n    <script type="text/javascript" src="//cdn.auth0.com/w2/auth0-7.0.4.min.js"><\/script>\n    <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.1672/js/bundle.js"><\/script>\n    <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;<\/script>\n    <% if (assets.vendors) { %><script type="text/javascript" src="/app/<%= assets.vendors %>"><\/script><% } %>\n    <% if (assets.app) { %><script type="text/javascript" src="/app/<%= assets.app %>"><\/script><% } %>\n    <% if (assets.version) { %>\n    <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-logs-to-fluentd/assets/auth0-logs-to-fluentd.ui.vendors.<%= assets.version %>.js"><\/script>\n    <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-logs-to-fluentd/assets/auth0-logs-to-fluentd.ui.<%= assets.version %>.js"><\/script>\n    <% } %>\n  </body>\n  </html>\n  ';return(t,r,s)=>{if(0===t.url.indexOf("/api"))return s();const a={AUTH0_DOMAIN:o("AUTH0_DOMAIN"),AUTH0_CLIENT_ID:o("EXTENSION_CLIENT_ID"),AUTH0_MANAGE_URL:o("AUTH0_MANAGE_URL")||"https://manage.auth0.com",BASE_URL:i.getBaseUrl(t),BASE_PATH:i.getBasePath(t),TITLE:o("TITLE")};return r.send(n.render(e,{config:a,assets:{customCss:o("CUSTOM_CSS"),version:"1.0.0"}}))}})}).call(t,"/")},function(e,t,r){const n=r(108),i=r(5).Router,o=r(4).middlewares,s=r(3),a=r(96);e.exports=(e=>{const t=i(),r=o.authenticateAdmins({credentialsRequired:!0,secret:s("EXTENSION_SECRET"),audience:"urn:logs-to-fluentd",baseUrl:s("PUBLIC_WT_URL")||s("WT_URL"),onLoginSuccess:(e,t,r)=>r()});return t.get("/",a()),t.get("/api/report",r,(t,r,i)=>e.read().then(e=>{const i=e&&e.logs?n.sortByOrder(e.logs,"start","desc"):[],o=t.query.filter&&"errors"===t.query.filter?n.filter(i,e=>!!e.error):i,s=t.query.page&&parseInt(t.query.page)?parseInt(t.query.page)-1:0,a=t.query.per_page&&parseInt(t.query.per_page)||10,u=a*s;return r.json({logs:o.slice(u,u+a),total:o.length})}).catch(i)),t})},function(e,t,r){const n=r(5),i=r(62);e.exports=(()=>{const e=n.Router();return e.get("/",(e,t)=>{t.status(200).send(i)}),e})},function(e,t,r){const n=r(4),i=r(44),o=r(3),s=r(7),a=n.createServer((e,t)=>(s.info("Starting Auth0 Logs to Fluentd Extension - Version:","1.0.0"),i(e,t)));e.exports=((e,t,r)=>{o.setValue("PUBLIC_WT_URL",n.urlHelpers.getWebtaskUrl(t)),a(e,t,r)})},function(e,t){e.exports=require("async@2.1.2")},function(e,t){e.exports=require("auth0-log-extension-tools@1.3.6")},function(e,t){e.exports=require("body-parser@1.12.4")},function(e,t){e.exports=require("cookie-signature@1.0.6")},function(e,t){e.exports=require("ejs@2.3.1")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("jsonwebtoken@7.1.9")},function(e,t){e.exports=require("jwks-rsa@1.1.1")},function(e,t){e.exports=require("lodash@3.10.1")},function(e,t){e.exports=require("moment@2.10.3")},function(e,t){e.exports=require("morgan@1.5.3")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("request@2.56.0")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("webtask-tools")},function(e,t){e.exports=require("winston@1.0.0")},function(e,t){e.exports=require("wrappy@1.0.1")},function(e,t){e.exports=require("zlib")}]);