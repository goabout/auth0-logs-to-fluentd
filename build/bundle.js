module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=59)}([function(e,t,r){var n=t.global=r(96),i=t.hasBuffer=n&&!!n.isBuffer,o=t.hasArrayBuffer="undefined"!=typeof ArrayBuffer,s=t.isArray=r(14);t.isArrayBuffer=o?function(e){return e instanceof ArrayBuffer||d(e)}:g;var a=t.isBuffer=i?n.isBuffer:g,u=t.isView=o?ArrayBuffer.isView||m("ArrayBuffer","buffer"):g;t.alloc=p,t.concat=function(e,r){r||(r=0,Array.prototype.forEach.call(e,function(e){r+=e.length}));var n=this!==t&&this||e[0],i=p.call(n,r),o=0;return Array.prototype.forEach.call(e,function(e){o+=h.copy.call(e,i,o)}),i},t.from=function(e){return"string"==typeof e?function(e){var t=3*e.length,r=p.call(this,t),n=h.write.call(r,e);t!==n&&(r=h.slice.call(r,0,n));return r}.call(this,e):v(this).from(e)};var c=t.Array=r(98),f=t.Buffer=r(99),l=t.Uint8Array=r(100),h=t.prototype=r(15);function p(e){return v(this).alloc(e)}var d=m("ArrayBuffer");function v(e){return a(e)?f:u(e)?l:s(e)?c:i?f:o?l:c}function g(){return!1}function m(e,t){return e="[object "+e+"]",function(r){return null!=r&&{}.toString.call(t?r[t]:r)===e}}},function(e,t){e.exports=require("auth0-extension-tools@1.3.1")},function(e,t,r){"use strict";e.exports=r(1).config()},function(e,t,r){const n=r(53),i=r(23),o=r(46),s=r(52);e.exports.createServer=n.createServer,e.exports.urlHelpers=i,e.exports.middlewares=o,e.exports.routes=s},function(e,t){e.exports=require("express@4.12.4")},function(e,t,r){"use strict";var n=r(41);n.emitErrs=!0;var i=new n.Logger({transports:[new n.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});e.exports=i,e.exports.stream={write:function(e){i.info(e.replace(/\n$/,""))}}},function(e,t,r){var n=r(14);t.createCodec=a,t.install=function(e){for(var t in e)o.prototype[t]=s(o.prototype[t],e[t])},t.filter=function(e){return n(e)?function(e){return e=e.slice(),function(r){return e.reduce(t,r)};function t(e,t){return t(e)}}(e):e};var i=r(0);function o(e){if(!(this instanceof o))return new o(e);this.options=e,this.init()}function s(e,t){return e&&t?function(){return e.apply(this,arguments),t.apply(this,arguments)}:e||t}function a(e){return new o(e)}o.prototype.init=function(){var e=this.options;return e&&e.uint8array&&(this.bufferish=i.Uint8Array),this},t.preset=a({preset:!0})},function(e,t){e.exports=require("util")},function(e,t){var r=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(e,t,r){e.exports=!r(10)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){!function(e){var t,r="undefined",n=r!==typeof Buffer&&Buffer,i=r!==typeof Uint8Array&&Uint8Array,o=r!==typeof ArrayBuffer&&ArrayBuffer,s=[0,0,0,0,0,0,0,0],a=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},u=4294967296,c=16777216;function f(a,f,E){var _=f?0:4,b=f?4:0,k=f?0:3,S=f?1:2,A=f?2:1,T=f?3:0,U=f?m:x,B=f?y:w,C=M.prototype,I="is"+a,L="_"+I;return C.buffer=void 0,C.offset=0,C[L]=!0,C.toNumber=O,C.toString=function(e){var t=this.buffer,r=this.offset,n=R(t,r+_),i=R(t,r+b),o="",s=!E&&2147483648&n;s&&(n=~n,i=u-i);e=e||10;for(;;){var a=n%e*u+i;if(n=Math.floor(n/e),i=Math.floor(a/e),o=(a%e).toString(e)+o,!n&&!i)break}s&&(o="-"+o);return o},C.toJSON=O,C.toArray=l,n&&(C.toBuffer=h),i&&(C.toArrayBuffer=p),M[I]=function(e){return!(!e||!e[L])},e[a]=M,M;function M(e,n,a,c){return this instanceof M?function(e,n,a,c,f){i&&o&&(n instanceof o&&(n=new i(n)),c instanceof o&&(c=new i(c)));if(!(n||a||c||t))return void(e.buffer=g(s,0));if(!d(n,a)){var l=t||Array;f=a,c=n,a=0,n=new l(8)}if(e.buffer=n,e.offset=a|=0,r===typeof c)return;"string"==typeof c?function(e,t,r,n){var i=0,o=r.length,s=0,a=0;"-"===r[0]&&i++;var c=i;for(;i<o;){var f=parseInt(r[i++],n);if(!(f>=0))break;a=a*n+f,s=s*n+Math.floor(a/u),a%=u}c&&(s=~s,a?a=u-a:s++);P(e,t+_,s),P(e,t+b,a)}(n,a,c,f||10):d(c,f)?v(n,a,c,f):"number"==typeof f?(P(n,a+_,c),P(n,a+b,f)):c>0?U(n,a,c):c<0?B(n,a,c):v(n,a,s,0)}(this,e,n,a,c):new M(e,n,a,c)}function O(){var e=this.buffer,t=this.offset,r=R(e,t+_),n=R(e,t+b);return E||(r|=0),r?r*u+n:n}function P(e,t,r){e[t+T]=255&r,r>>=8,e[t+A]=255&r,r>>=8,e[t+S]=255&r,r>>=8,e[t+k]=255&r}function R(e,t){return e[t+k]*c+(e[t+S]<<16)+(e[t+A]<<8)+e[t+T]}}function l(e){var r=this.buffer,n=this.offset;return t=null,!1!==e&&0===n&&8===r.length&&a(r)?r:g(r,n)}function h(e){var r=this.buffer,i=this.offset;if(t=n,!1!==e&&0===i&&8===r.length&&Buffer.isBuffer(r))return r;var o=new n(8);return v(o,0,r,i),o}function p(e){var r=this.buffer,n=this.offset,s=r.buffer;if(t=i,!1!==e&&0===n&&s instanceof o&&8===s.byteLength)return s;var a=new i(8);return v(a,0,r,n),a.buffer}function d(e,t){var r=e&&e.length;return t|=0,r&&t+8<=r&&"string"!=typeof e[t]}function v(e,t,r,n){t|=0,n|=0;for(var i=0;i<8;i++)e[t++]=255&r[n++]}function g(e,t){return Array.prototype.slice.call(e,t,t+8)}function m(e,t,r){for(var n=t+8;n>t;)e[--n]=255&r,r/=256}function y(e,t,r){var n=t+8;for(r++;n>t;)e[--n]=255&-r^255,r/=256}function x(e,t,r){for(var n=t+8;t<n;)e[t++]=255&r,r/=256}function w(e,t,r){var n=t+8;for(r++;t<n;)e[t++]=255&-r^255,r/=256}f("Uint64BE",!0,!0),f("Int64BE",!0,!1),f("Uint64LE",!1,!0),f("Int64LE",!1,!1)}("object"==typeof t&&"string"!=typeof t.nodeName?t:this||{})},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){var n=r(97);t.copy=u,t.slice=c,t.toString=function(e,t,r){return(!s&&i.isBuffer(this)?this.toString:n.toString).apply(this,arguments)},t.write=function(e){return function(){return(this[e]||n[e]).apply(this,arguments)}}("write");var i=r(0),o=i.global,s=i.hasBuffer&&"TYPED_ARRAY_SUPPORT"in o,a=s&&!o.TYPED_ARRAY_SUPPORT;function u(e,t,r,o){var s=i.isBuffer(this),u=i.isBuffer(e);if(s&&u)return this.copy(e,t,r,o);if(a||s||u||!i.isView(this)||!i.isView(e))return n.copy.call(this,e,t,r,o);var f=r||null!=o?c.call(this,r,o):this;return e.set(f,t),f.length}function c(e,t){var r=this.slice||!a&&this.subarray;if(r)return r.call(this,e,t);var n=i.alloc.call(this,t-e);return u.call(this,n,0,e,t),n}},function(e,t,r){t.DecodeBuffer=i;var n=r(19).preset;function i(e){if(!(this instanceof i))return new i(e);if(e&&(this.options=e,e.codec)){var t=this.codec=e.codec;t.bufferish&&(this.bufferish=t.bufferish)}}r(35).FlexDecoder.mixin(i.prototype),i.prototype.codec=n,i.prototype.fetch=function(){return this.codec.decode(this)}},function(e,t,r){t.EncodeBuffer=i;var n=r(20).preset;function i(e){if(!(this instanceof i))return new i(e);if(e&&(this.options=e,e.codec)){var t=this.codec=e.codec;t.bufferish&&(this.bufferish=t.bufferish)}}r(35).FlexEncoder.mixin(i.prototype),i.prototype.codec=n,i.prototype.write=function(e){this.codec.encode(this,e)}},function(e,t,r){t.ExtBuffer=function e(t,r){if(!(this instanceof e))return new e(t,r);this.buffer=n.from(t);this.type=r};var n=r(0)},function(e,t,r){var n=r(18).ExtBuffer,i=r(107),o=r(36).readUint8,s=r(109),a=r(6);function u(){var e=this.options;return this.decode=function(e){var t=s.getReadToken(e);return function(e){var r=o(e),n=t[r];if(!n)throw new Error("Invalid type: "+(r?"0x"+r.toString(16):r));return n(e)}}(e),e&&e.preset&&i.setExtUnpackers(this),this}a.install({addExtUnpacker:function(e,t){(this.extUnpackers||(this.extUnpackers=[]))[e]=a.filter(t)},getExtUnpacker:function(e){return(this.extUnpackers||(this.extUnpackers=[]))[e]||function(t){return new n(t,e)}},init:u}),t.preset=u.call(a.preset)},function(e,t,r){var n=r(18).ExtBuffer,i=r(106),o=r(111),s=r(6);function a(){var e=this.options;return this.encode=function(e){var t=o.getWriteType(e);return function(e,r){var n=t[typeof r];if(!n)throw new Error('Unsupported type "'+typeof r+'": '+r);n(e,r)}}(e),e&&e.preset&&i.setExtPackers(this),this}s.install({addExtPacker:function(e,t,r){r=s.filter(r);var i=t.name;if(i&&"Object"!==i){var o=this.extPackers||(this.extPackers={});o[i]=u}else{var a=this.extEncoderList||(this.extEncoderList=[]);a.unshift([t,u])}function u(t){return r&&(t=r(t)),new n(t,e)}},getExtPacker:function(e){var t=this.extPackers||(this.extPackers={}),r=e.constructor,n=r&&r.name&&t[r.name];if(n)return n;for(var i=this.extEncoderList||(this.extEncoderList=[]),o=i.length,s=0;s<o;s++){var a=i[s];if(r===a[0])return a[1]}},init:a}),t.preset=a.call(s.preset)},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("url")},function(e,t,r){const n=r(22),i=3,o=2,s=1,a=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports.getBasePath=function(e){return t=e.originalUrl||"",r=e.path,(i=(i=n.parse(t).pathname||"").replace(r,"").replace(/^\/|\/$/g,"")).startsWith("/")||(i="/"+i),i.endsWith("/")||(i+="/"),i;var t,r,i},e.exports.getBaseUrl=function(e,t){var r=t;const i=n.parse(e.originalUrl||"").pathname||"";return n.format({protocol:r||"https",host:e.headers.host,pathname:i.replace(e.path,"").replace(/\/$/g,"")})},e.exports.getWebtaskUrl=function(e){const t=function(e){if(!e.container)return null;const t=e.container.replace(a,"\\$&"),r=e.jtn?e.jtn.replace(a,"\\$&"):"";if(e.url_format===s)return new RegExp("^/api/run/"+t+"/(?:"+r+"/?)?");if(e.url_format===o)return new RegExp("^/"+t+"/(?:"+r+"/?)?");if(e.url_format===i)return new RegExp("^/(?:"+r+"/?)?");throw new Error("Unsupported webtask URL format.")}(e.x_wt),r=e.url,u=e.url.replace(t,"/"),c=n.parse(u||"").pathname,f=e.x_wt&&e.x_wt.ectx&&e.x_wt.ectx.ISOLATED_DOMAIN||!1,l=n.parse(r||"").pathname||"";var h;if(f){h=n.format({protocol:"https",host:e.headers.host,pathname:l.replace(c,"").replace(/\/$/g,"")});const t=".it.auth0.com/api/run/"+e.x_wt.container+"/",r=function(e,t){if(!e)return null;const r=e.indexOf("sandbox8")>=0?"8":"";return"https://"+t+"."+(e.split(".it.auth0.com")[0].split("-")[1]||"us")+r+".webtask.io/"}(h,e.x_wt.container);h.indexOf(t)>=0&&(h=h.replace("https://"+e.headers.host+"/api/run/"+e.x_wt.container+"/",r))}else h=l;return h}},function(e,t,r){"use strict";var n=r(112);e.exports=function(e,t,r){return function(i,o,s){var a=n(s);return!0===e||"function"==typeof e&&e(i,o,a)?t(i,o,a):r?r(i,o,a):a()}}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(75),i=r(25);e.exports=function(e){return n(i(e))}},function(e,t,r){!function(t){e.exports=t;var r="listeners",n={on:function(e,t){return s(this,e).push(t),this},once:function(e,t){var r=this;return n.originalListener=t,s(r,e).push(n),r;function n(){o.call(r,e,n),t.apply(this,arguments)}},off:o,emit:function(e,t){var r=this,n=s(r,e,!0);if(!n)return!1;var i=arguments.length;if(1===i)n.forEach(function(e){e.call(r)});else if(2===i)n.forEach(function(e){e.call(r,t)});else{var o=Array.prototype.slice.call(arguments,1);n.forEach(function(e){e.apply(r,o)})}return!!n.length}};function i(e){for(var t in n)e[t]=n[t];return e}function o(e,t){var n;if(arguments.length){if(t){if(n=s(this,e,!0)){if(!(n=n.filter(function(e){return e!==t&&e.originalListener!==t})).length)return o.call(this,e);this[r][e]=n}}else if((n=this[r])&&(delete n[e],!Object.keys(n).length))return o.call(this)}else delete this[r];return this}function s(e,t,n){if(!n||e[r]){var i=e[r]||(e[r]={});return i[t]||(i[t]=[])}}i(t.prototype),t.mixin=i}(
/**
 * event-lite.js - Light-weight EventEmitter (less than 1KB when gzipped)
 *
 * @copyright Yusuke Kawasaki
 * @license MIT
 * @constructor
 * @see https://github.com/kawanet/event-lite
 * @see http://kawanet.github.io/event-lite/EventLite.html
 * @example
 * var EventLite = require("event-lite");
 *
 * function MyClass() {...}             // your class
 *
 * EventLite.mixin(MyClass.prototype);  // import event methods
 *
 * var obj = new MyClass();
 * obj.on("foo", function() {...});     // add event listener
 * obj.once("bar", function() {...});   // add one-time event listener
 * obj.emit("foo");                     // dispatch event
 * obj.emit("bar");                     // dispatch another event
 * obj.off("foo");                      // remove event listener
 */
function e(){if(!(this instanceof e))return new e})},function(e,t,r){"use strict";var n=function(e,t){this.epoch=e,this.nano=t};n.pack=function(e){var t=Buffer.alloc(8);return t.writeUInt32BE(e.epoch,0),t.writeUInt32BE(e.nano,4),t},n.unpack=function(e){var t=e.readUInt32BE(0),r=e.readUInt32BE(4);return new n(t,r)},n.now=function(){var e=Date.now();return n.fromTimestamp(e)},n.fromDate=function(e){var t=e.getTime();return n.fromTimestamp(t)},n.fromTimestamp=function(e){var t=Math.floor(e/1e3);return new n(t,1e6*(e-1e3*t))},e.exports={},e.exports.EventTime=n},function(e,t,r){"use strict";var n=r(118).EventEmitter,i=r(95),o=r(125),s=r(21),a=r(38),u=r(127),c=r(130),f=r(90),l=r(29).EventTime,h=i.createCodec();function p(e,t){if(t=t||{},this._eventMode=t.eventMode||"Message",!/^Message|PackedForward|CompressedPackedForward$/.test(this._eventMode))throw new f.ConfigError("Unknown event mode: "+this._eventMode);this.tag_prefix=e,this.host=t.host||"localhost",this.port=t.port||24224,this.path=t.path,this.timeout=t.timeout||3,this.tls=!!t.tls,this.tlsOptions=t.tlsOptions||{},this.reconnectInterval=t.reconnectInterval||6e5,this.requireAckResponse=t.requireAckResponse,this.ackResponseTimeout=t.ackResponseTimeout||19e4,this.internalLogger=t.internalLogger||console,this._timeResolution=t.milliseconds?1:1e3,this._socket=null,"Message"===this._eventMode?(this._sendQueue=[],this._flushInterval=0):(this._sendQueue=new Map,this._flushInterval=t.flushInterval||100,this._sendQueueSizeLimit=8388608,this._sendQueueSize=0,this._flushSendQueueTimeoutId=null,this._compressed="CompressedPackedForward"===this._eventMode),this._eventEmitter=new n,this.security=t.security||{clientHostname:null,sharedKey:null,username:"",password:""},this.sharedKeySalt=a.randomBytes(16).toString("hex"),this._status=null,this._connecting=!1}h.addExtPacker(0,l,l.pack),h.addExtUnpacker(0,l.unpack),p.prototype.emit=function(){var e,t,r,n,i=Array.prototype.slice.call(arguments);"string"==typeof i[0]&&(e=i.shift()),t=i.shift(),"function"!=typeof i[0]&&(r=i.shift()),"function"==typeof i[0]&&(n=i.shift());let o,s,a=this._makeTag(e);return null===a?(s={tag_prefix:this.tag_prefix,label:e},o=new f.MissingTag("tag is missing",s),void this._handleEvent("error",o,n)):"object"!=typeof t?(s={tag_prefix:this.tag_prefix,label:e,record:t},o=new f.DataTypeError("data must be an object",s),void this._handleEvent("error",o,n)):(this._push(a,r,t,n),void this._connect(()=>{this._flushSendQueue()}))},["addListener","on","once","removeListener","removeAllListeners","setMaxListeners","getMaxListeners"].forEach((e,t)=>{p.prototype[e]=function(){return this._eventEmitter[e].apply(this._eventEmitter,Array.prototype.slice.call(arguments))}}),p.prototype.end=function(e,t,r){null!=e&&null!=t?this.emit(e,t,e=>{this._close(),e?this._handleEvent("error",e,r):r&&r()}):process.nextTick(()=>{this._close(),r&&r()})},p.prototype._close=function(){this._socket&&(this._socket.end(),this._socket=null,this._status=null)},p.prototype._makeTag=function(e){let t=null;return this.tag_prefix&&e?t=[this.tag_prefix,e].join("."):this.tag_prefix?t=this.tag_prefix:e&&(t=e),t},p.prototype._makePacketItem=function(e,t,r){"number"==typeof t||t instanceof l||(t=Math.floor((t?t.getTime():Date.now())/this._timeResolution));var n=[e,t,r],o={};return this.requireAckResponse&&(o={chunk:a.randomBytes(16).toString("base64")},n.push(o)),{packet:i.encode(n,{codec:h}),tag:e,time:t,data:r,options:o}},p.prototype._makeEventEntry=function(e,t){return"number"==typeof e||e instanceof l||(e=Math.floor((e?e.getTime():Date.now())/this._timeResolution)),i.encode([e,t],{codec:h})},p.prototype._push=function(e,t,r,n){if("Message"===this._eventMode){let i=this._makePacketItem(e,t,r);i.callback=n,this._sendQueue.push(i)}else{let i=this._makeEventEntry(t,r);if(this._sendQueueSize+=i.length,this._sendQueue.has(e)){let t=this._sendQueue.get(e);t.eventEntry=Buffer.concat([t.eventEntry,i]),t.callbacks.push(n),this._sendQueue.set(e,t)}else this._sendQueue.set(e,{eventEntry:i,callbacks:[n]})}},p.prototype._connect=function(e){this._connecting||(this._connecting=!0,process.nextTick(()=>{null===this._socket?this._doConnect(()=>{this._connecting=!1,e()}):this._socket.writable?process.nextTick(()=>{this._connecting=!1,e()}):(this._disconnect(),process.nextTick(()=>{this._connecting=!1,this._connect(e)}))}))},p.prototype._doConnect=function(e){let t=()=>{let e=e=>{this._socket&&(this._disconnect(),this._handleEvent("error",e))};this._socket.on("error",e),this._socket.on("connect",()=>{this._handleEvent("connect")}),this.tls&&(this._socket.on("tlsClientError",e),this._socket.on("secureConnect",()=>{this._handleEvent("connect")}))};if(this.tls||(this._socket=new o.Socket,this._socket.setTimeout(this.timeout),t()),this.path)this.tls?(this._socket=u.connect(Object.assign({},this.tlsOptions,{path:this.path}),()=>{e()}),t()):this._socket.connect(this.path,()=>{e()});else{let r=()=>{this.security.clientHostname&&null!==this.security.sharedKey?this._handshake(e):(this._status="established",e())};this.tls?(this._socket=u.connect(Object.assign({},this.tlsOptions,{host:this.host,port:this.port}),()=>{r()}),t()):this._socket.connect(this.port,this.host,()=>{r()})}},p.prototype._disconnect=function(){this._socket&&this._socket.destroy(),this._socket=null,this._status=null,this._connecting=!1},p.prototype._handshake=function(e){"established"!==this._status&&(this._status="helo",this._socket.once("data",t=>{if(this._socket.pause(),!this._checkHelo(t).succeeded)return this.internalLogger.error("Received invalid HELO message from "+this._socket.remoteAddress),void this._disconnect();this._status="pingpong",this._socket.write(new Buffer(this._generatePing()),()=>{this._socket.resume(),this._socket.once("data",t=>{let r=this._checkPong(t);if(!r.succeeded){this.internalLogger.error(r.message);let e=new f.HandshakeError(r.message);return this._handleEvent("error",e),void this._disconnect()}this._status="established",this.internalLogger.info("Established"),e()})})}))},p.prototype._flushSendQueue=function(){this._flushingSendQueue||(this._flushingSendQueue=!0,process.nextTick(()=>{this._waitToWrite()}))},p.prototype._waitToWrite=function(){this._socket?this._socket.writable?"Message"===this._eventMode?this._doFlushSendQueue():this._sendQueueSize>=this._sendQueueSizeLimit?(this._flushSendQueueTimeoutId&&clearTimeout(this._flushSendQueueTimeoutId),this._doFlushSendQueue()):(this._flushSendQueueTimeoutId&&clearTimeout(this._flushSendQueueTimeoutId),this._flushSendQueueTimeoutId=setTimeout(()=>{this._doFlushSendQueue()},this._flushInterval)):process.nextTick(()=>{this._waitToWrite()}):this._flushingSendQueue=!1},p.prototype._doFlushSendQueue=function(e){if("Message"===this._eventMode){let t=this._sendQueue.shift();if(void 0===t)return void(this._flushingSendQueue=!1);this._doWrite(t.packet,t.options,e,[t.callback])}else{if(0===this._sendQueue.size)return void(this._flushingSendQueue=!1);let t=Array.from(this._sendQueue.keys())[0],r=this._sendQueue.get(t),n=r.eventEntry,o=r.eventEntry.length;this._sendQueue.delete(t),this._compressed&&(o=(n=c.gzipSync(n)).length);let s={chunk:a.randomBytes(16).toString("base64"),size:o,compressed:this._compressed?"gzip":"text"},u=i.encode([t,n,s],{codec:h});this._doWrite(u,s,e,r.callbacks)}},p.prototype._doWrite=function(e,t,r,n){const o=this._sendQueueSize;this._socket.write(new Buffer(e),()=>{this.requireAckResponse?(this._socket.once("data",e=>{r&&clearTimeout(r);var s=i.decode(e,{codec:h});if(s.ack!==t.chunk){var a=new f.ResponseError("ack in response and chunk id in sent data are different",{ack:s.ack,chunk:t.chunk});n.forEach(e=>{this._handleEvent("error",a,e)})}this._sendQueueSize-=o,n.forEach(e=>{e&&e()}),process.nextTick(()=>{this._waitToWrite()})}),r=setTimeout(()=>{var e=new f.ResponseTimeout("ack response timeout");n.forEach(t=>{this._handleEvent("error",e,t)})},this.ackResponseTimeout)):(this._sendQueueSize-=o,n.forEach(e=>{e&&e()}),process.nextTick(()=>{this._waitToWrite()}))})},p.prototype._handleEvent=function(e,t,r){r&&r(t),this._eventEmitter.listenerCount(e)>0&&this._eventEmitter.emit(e,t)},p.prototype._setupErrorHandler=function(e){this.reconnectInterval&&this.on("error",t=>{this._flushingSendQueue=!1,this._status=null,this.internalLogger.error("Fluentd error",t),this.internalLogger.info("Fluentd will reconnect after "+this.reconnectInterval/1e3+" seconds");let r=setTimeout(()=>{this.internalLogger.info("Fluentd is reconnecting..."),this._connect(()=>{this.internalLogger.info("Fluentd reconnection finished!!")})},this.reconnectInterval);e&&e(r)})},p.prototype._checkHelo=function(e){this.internalLogger.info("Checking HELO...");var t=i.decode(e);if(2!==t.length)return{succeeded:!1,message:"Invalid format for HELO message"};if("HELO"!==t[0])return{succeeded:!1,message:"Invalid format for HELO message"};var r=t[1]||{};return this.sharedKeyNonce=r.nonce||"",this.authentication=r.auth||"",{succeeded:!0}},p.prototype._generatePing=function(){var e=a.createHash("sha512").update(this.sharedKeySalt).update(this.security.clientHostname).update(this.sharedKeyNonce).update(this.security.sharedKey).digest("hex"),t=["PING",this.security.clientHostname,this.sharedKeySalt,e];if(Buffer.isBuffer(this.authentication)&&0!==Buffer.byteLength(this.authentication)){var r=a.createHash("sha512").update(this.authentication).update(this.security.username||"").update(this.security.password||"").digest("hex");t.push(this.username,r)}else t.push("","");return i.encode(t)},p.prototype._checkPong=function(e){this.internalLogger.info("Checking PONG...");var t=i.decode(e);if(5!==t.length)return!1;if("PONG"!==t[0])return{succeeded:!1,message:"Invalid format for PONG message"};t[0];var r=t[1],n=t[2],o=t[3],s=t[4];return r?o===this.security.clientHostname?{succeeded:!1,message:"Same hostname between input and output: invalid configuration"}:s!==a.createHash("sha512").update(this.sharedKeySalt).update(o).update(this.sharedKeyNonce).update(this.security.sharedKey).digest("hex")?{succeeded:!1,message:"Sharedkey mismatch"}:{succeeded:!0}:{succeeded:!1,message:"Authentication failed: "+n}},p.prototype.toStream=function(e){var t=(e="string"==typeof e?{label:e}:e||{}).label;if(!t)throw new Error("label is needed");var r=e.encoding||"UTF-8",n=new s.Writable,i="";return n._write=((e,n,o)=>{var s=e.toString(r).split(/\n/),a=()=>{s.length&&(i+=s.shift()),s.length?this.emit(t,{message:i},e=>{e?this._handleEvent("error",e,o):(i="",a())}):process.nextTick(o)};a()}),n},e.exports={},e.exports.FluentSender=p},function(e,t){t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,f=-7,l=r?i-1:0,h=r?-1:1,p=e[t+l];for(l+=h,o=p&(1<<-f)-1,p>>=-f,f+=a;f>0;o=256*o+e[t+l],l+=h,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=n;f>0;s=256*s+e[t+l],l+=h,f-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,f=(1<<c)-1,l=f>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+l>=1?h/u:h*Math.pow(2,1-l))*u>=2&&(s++,u/=2),s+l>=f?(a=0,s=f):s+l>=1?(a=(t*u-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+p]=255&s,p+=d,s/=256,c-=8);e[r+p-d]|=128*v}},function(e,t,r){"use strict";var n=r(94);function i(e){this.message=e}i.prototype=new Error,i.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new i("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(n(e.split(".")[r]))}catch(e){throw new i("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=i},function(e,t,r){t.decode=function(e,t){var r=new n(t);return r.write(e),r.read()};var n=r(16).DecodeBuffer},function(e,t,r){t.encode=function(e,t){var r=new n(t);return r.write(e),r.read()};var n=r(17).EncodeBuffer},function(e,t,r){t.FlexDecoder=a,t.FlexEncoder=u;var n=r(0),i=2048,o=65536,s="BUFFER_SHORTAGE";function a(){if(!(this instanceof a))return new a}function u(){if(!(this instanceof u))return new u}function c(){throw new Error("method not implemented: write()")}function f(){throw new Error("method not implemented: fetch()")}function l(){return this.buffers&&this.buffers.length?(this.flush(),this.pull()):this.fetch()}function h(e){(this.buffers||(this.buffers=[])).push(e)}function p(){return(this.buffers||(this.buffers=[])).shift()}function d(e){return function(t){for(var r in e)t[r]=e[r];return t}}a.mixin=d(function(){return{bufferish:n,write:function(e){var t=this.offset?n.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=t?e?this.bufferish.concat([t,e]):t:e,this.offset=0},fetch:f,flush:function(){for(;this.offset<this.buffer.length;){var e,t=this.offset;try{e=this.fetch()}catch(e){if(e&&e.message!=s)throw e;this.offset=t;break}this.push(e)}},push:h,pull:p,read:l,reserve:function(e){var t=this.offset,r=t+e;if(r>this.buffer.length)throw new Error(s);return this.offset=r,t},offset:0}}()),a.mixin(a.prototype),u.mixin=d(function(){return{bufferish:n,write:c,fetch:function(){var e=this.start;if(e<this.offset){var t=this.start=this.offset;return n.prototype.slice.call(this.buffer,e,t)}},flush:function(){for(;this.start<this.offset;){var e=this.fetch();e&&this.push(e)}},push:h,pull:function(){var e=this.buffers||(this.buffers=[]),t=e.length>1?this.bufferish.concat(e):e[0];return e.length=0,t},read:l,reserve:function(e){var t=0|e;if(this.buffer){var r=this.buffer.length,n=0|this.offset,i=n+t;if(i<r)return this.offset=i,n;this.flush(),e=Math.max(e,Math.min(2*r,this.maxBufferSize))}return e=Math.max(e,this.minBufferSize),this.buffer=this.bufferish.alloc(e),this.start=0,this.offset=t,0},send:function(e){var t=e.length;if(t>this.minBufferSize)this.flush(),this.push(e);else{var r=this.reserve(t);n.prototype.copy.call(e,this.buffer,r)}},maxBufferSize:o,minBufferSize:i,offset:0,start:0}}()),u.mixin(u.prototype)},function(e,t,r){var n=r(31),i=r(13),o=i.Uint64BE,s=i.Int64BE;t.getReadFormat=function(e){var t=a.hasArrayBuffer&&e&&e.binarraybuffer,r=e&&e.int64;return{map:c&&e&&e.usemap?h:l,array:p,str:d,bin:t?g:v,ext:m,uint8:y,uint16:w,uint32:_,uint64:k(8,r?T:S),int8:x,int16:E,int32:b,int64:k(8,r?U:A),float32:k(4,B),float64:k(8,C)}},t.readUint8=y;var a=r(0),u=r(15),c="undefined"!=typeof Map,f=!0;function l(e,t){var r,n={},i=new Array(t),o=new Array(t),s=e.codec.decode;for(r=0;r<t;r++)i[r]=s(e),o[r]=s(e);for(r=0;r<t;r++)n[i[r]]=o[r];return n}function h(e,t){var r,n=new Map,i=new Array(t),o=new Array(t),s=e.codec.decode;for(r=0;r<t;r++)i[r]=s(e),o[r]=s(e);for(r=0;r<t;r++)n.set(i[r],o[r]);return n}function p(e,t){for(var r=new Array(t),n=e.codec.decode,i=0;i<t;i++)r[i]=n(e);return r}function d(e,t){var r=e.reserve(t),n=r+t;return u.toString.call(e.buffer,"utf-8",r,n)}function v(e,t){var r=e.reserve(t),n=r+t,i=u.slice.call(e.buffer,r,n);return a.from(i)}function g(e,t){var r=e.reserve(t),n=r+t,i=u.slice.call(e.buffer,r,n);return a.Uint8Array.from(i).buffer}function m(e,t){var r=e.reserve(t+1),n=e.buffer[r++],i=r+t,o=e.codec.getExtUnpacker(n);if(!o)throw new Error("Invalid ext type: "+(n?"0x"+n.toString(16):n));return o(u.slice.call(e.buffer,r,i))}function y(e){var t=e.reserve(1);return e.buffer[t]}function x(e){var t=e.reserve(1),r=e.buffer[t];return 128&r?r-256:r}function w(e){var t=e.reserve(2),r=e.buffer;return r[t++]<<8|r[t]}function E(e){var t=e.reserve(2),r=e.buffer,n=r[t++]<<8|r[t];return 32768&n?n-65536:n}function _(e){var t=e.reserve(4),r=e.buffer;return 16777216*r[t++]+(r[t++]<<16)+(r[t++]<<8)+r[t]}function b(e){var t=e.reserve(4),r=e.buffer;return r[t++]<<24|r[t++]<<16|r[t++]<<8|r[t]}function k(e,t){return function(r){var n=r.reserve(e);return t.call(r.buffer,n,f)}}function S(e){return new o(this,e).toNumber()}function A(e){return new s(this,e).toNumber()}function T(e){return new o(this,e)}function U(e){return new s(this,e)}function B(e){return n.read(this,e,!1,23,4)}function C(e){return n.read(this,e,!1,52,8)}},function(e,t){for(var r=t.uint8=new Array(256),n=0;n<=255;n++)r[n]=i(n);function i(e){return function(t){var r=t.reserve(1);t.buffer[r]=e}}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("express-jwt@3.1.0")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("winston@1.0.0")},function(e,t,r){"use strict";(function(t){r(22);var n=r(40),i=r(124),o=r(4),s=r(115),a=r(1),u=r(3),c=r(57),f=r(58),l=r(55),h=r(5),p=r(2),d=r(54);e.exports=function(e,r){p.setProvider(e);var v=r?new a.WebtaskStorageContext(r,{force:1}):new a.FileStorageContext(n.join(t,"./data.json"),{mergeWrites:!0}),g=new o;g.use(i(":method :url :status :response-time ms - :res[content-length]",{stream:h.stream}));var m=function(e){return function(t,r,n){return t.webtaskContext&&t.webtaskContext.body?(t.body=t.webtaskContext.body,n()):e(t,r,n)}};return g.use(m(s.json())),g.use(m(s.urlencoded({extended:!1}))),g.use("/meta",f()),g.use("/.extensions",l()),g.use(d(v)),g.use(u.routes.dashboardAdmins({secret:p("EXTENSION_SECRET"),audience:"urn:logs-to-fluentd",rta:p("AUTH0_RTA").replace("https://",""),domain:p("AUTH0_DOMAIN"),baseUrl:p("PUBLIC_WT_URL")||p("WT_URL"),clientName:"Logs to Fluentd",urlPrefix:"",sessionStorageKey:"logs-to-fluentd:apiToken"})),g.use("/app",o.static(n.join(t,"../dist"))),g.use("/",c(v)),g.use(u.middlewares.errorHandler(h.error.bind(h))),g}}).call(t,"/")},function(e,t,r){const n=r(32),i=r(39),o=r(1),s=r(24);e.exports=function(e){if(!e||"object"!=typeof e)throw new o.ArgumentError("Must provide the options");if(null===e.secret||void 0===e.secret)throw new o.ArgumentError("Must provide a valid secret");if("string"!=typeof e.secret||0===e.secret.length)throw new o.ArgumentError("The provided secret is invalid: "+e.secret);if(null===e.audience||void 0===e.audience)throw new o.ArgumentError("Must provide a valid secret");if("string"!=typeof e.audience||0===e.audience.length)throw new o.ArgumentError("The provided audience is invalid: "+e.audience);if(null===e.baseUrl||void 0===e.baseUrl)throw new o.ArgumentError("Must provide a valid base URL");if("string"!=typeof e.baseUrl||0===e.baseUrl.length)throw new o.ArgumentError("The provided base URL is invalid: "+e.baseUrl);const t=i({audience:e.audience,issuer:e.baseUrl,secret:e.secret,algorithms:["HS256"],credentialsRequired:e.credentialsRequired||!0});return function(r,n,i){t(r,n,function(t){return t?i(t):e.onLoginSuccess?e.onLoginSuccess(r,n,i):i()})}},e.exports.optional=function(t){const r=e.exports(t);return s(function(e){if(e&&e.headers&&e.headers.authorization&&0===e.headers.authorization.indexOf("Bearer "))try{const r=n(e.headers.authorization.split(" ")[1]);return r&&r.iss===t.baseUrl}catch(e){return!1}return!1},r)}},function(e,t,r){const n=r(32),i=r(39),o=r(121),s=r(1),a=r(24),u=r(1).UnauthorizedError;e.exports=function(e){if(!e||"object"!=typeof e)throw new s.ArgumentError("Must provide the options");if(null===e.domain||void 0===e.domain)throw new s.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new s.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.audience||void 0===e.audience)throw new s.ArgumentError("Must provide a valid audience");if("string"!=typeof e.audience||0===e.audience.length)throw new s.ArgumentError("The provided audience is invalid: "+e.audience);const t=i({secret:o.expressJwtSecret({cache:!0,rateLimit:!0,jwksRequestsPerMinute:5,jwksUri:"https://"+e.domain+"/.well-known/jwks.json",handleSigningKeyError:function(e,t){return e instanceof o.SigningKeyNotFoundError?t(new u("A token was provided with an invalid kid")):t(e)}}),audience:e.audience,issuer:"https://"+e.domain+"/",algorithms:["RS256"],credentialsRequired:e&&e.credentialsRequired||!0});return function(r,n,i){t(r,n,function(t){return t?i(t):e.onLoginSuccess?e.onLoginSuccess(r,n,i):i()})}},e.exports.optional=function(t){const r=e.exports(t);return a(function(e){if(e&&e.headers&&e.headers.authorization&&0===e.headers.authorization.indexOf("Bearer "))try{const r=n(e.headers.authorization.split(" ")[1]);return r&&r.iss==="https://"+t.domain+"/"}catch(e){return!1}return!1},r)}},function(e,t,r){e.exports=function(e){return function(t,r,n,i){return e&&e(t),t&&t.status?(n.status(t.status),n.json({error:t.code||t.name,message:t.message||t.name})):(n.status(t.status||500),n.json({error:"InternalServerError",message:t.message||t.name}))}}},function(e,t,r){e.exports.authenticateAdmins=r(43),e.exports.authenticateUsers=r(44),e.exports.requireAuthentication=r(48),e.exports.errorHandler=r(45),e.exports.managementApiClient=r(47),e.exports.validateHookToken=r(49),e.exports.webtaskConfig=r(50)},function(e,t,r){const n=r(1);e.exports=function(e){return function(t,r,i){const o=t,s=t.user&&t.user.access_token&&t.user.access_token.length?{domain:e.domain,accessToken:t.user.access_token}:e;n.managementApi.getClient(s).then(function(e){return o.auth0=e,i(),null}).catch(function(e){i(e)})}}},function(e,t,r){const n=r(1).UnauthorizedError;e.exports=function(e,t,r){return e.user?r():r(new n("Authentication required for this endpoint."))}},function(e,t,r){const n=r(1);e.exports=function(e,t,r){if(null==e)throw new n.ArgumentError("Must provide the domain");if("string"!=typeof e||0===e.length)throw new n.ArgumentError("The provided domain is invalid: "+e);if(null==t)throw new n.ArgumentError("Must provide the webtaskUrl");if("string"!=typeof t||0===t.length)throw new n.ArgumentError("The provided webtaskUrl is invalid: "+t);if(null==r)throw new n.ArgumentError("Must provide the extensionSecret");if("string"!=typeof r||0===r.length)throw new n.ArgumentError("The provided extensionSecret is invalid: "+r);return function(i){if(null==i)throw new n.ArgumentError("Must provide the hookPath");if("string"!=typeof i||0===i.length)throw new n.ArgumentError("The provided hookPath is invalid: "+i);return function(o,s,a){if(o.headers.authorization&&"Bearer"===o.headers.authorization.split(" ")[0]){const s=o.headers.authorization.split(" ")[1];try{if(n.validateHookToken(e,t,i,r,s))return a()}catch(e){return a(e)}}return a(new n.HookTokenError("Hook token missing for the call to: "+i))}}}},function(e,t,r){const n=r(1);e.exports=function(e){return function(t,r,i){return t.webtaskContext&&e.setProvider(n.configProvider.fromWebtaskContext(t.webtaskContext)),i()}}},function(e,t,r){const n=r(4),i=r(38),o=r(61),s=r(120),a=r(1),u=r(23);e.exports=function(e){if(!e||"object"!=typeof e)throw new a.ArgumentError("Must provide the options");if(null===e.secret||void 0===e.secret)throw new a.ArgumentError("Must provide a valid secret");if("string"!=typeof e.secret||0===e.secret.length)throw new a.ArgumentError("The provided secret is invalid: "+e.secret);if(null===e.audience||void 0===e.audience)throw new a.ArgumentError("Must provide a valid audience");if("string"!=typeof e.audience||0===e.audience.length)throw new a.ArgumentError("The provided audience is invalid: "+e.audience);if(null===e.rta||void 0===e.rta)throw new a.ArgumentError("Must provide a valid rta");if("string"!=typeof e.rta||0===e.rta.length)throw new a.ArgumentError("The provided rta is invalid: "+e.rta);if(null===e.domain||void 0===e.domain)throw new a.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new a.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.baseUrl||void 0===e.baseUrl)throw new a.ArgumentError("Must provide a valid base URL");if("string"!=typeof e.baseUrl||0===e.baseUrl.length)throw new a.ArgumentError("The provided base URL is invalid: "+e.baseUrl);if(null===e.clientName||void 0===e.clientName)throw new a.ArgumentError("Must provide a valid client name");if("string"!=typeof e.clientName||0===e.clientName.length)throw new a.ArgumentError("The provided client name is invalid: "+e.clientName);const t=e.stateKey||"state",r=e.nonceKey||"nonce",c=e.urlPrefix||"",f=e.sessionStorageKey||"apiToken",l=n.Router();return l.get(c+"/login",function(n,o){const s=i.randomBytes(16).toString("hex"),f=i.randomBytes(16).toString("hex");o.cookie(t,s),o.cookie(r,f);const l=new a.SessionManager(e.rta,e.domain,e.baseUrl).createAuthorizeUrl({redirectUri:u.getBaseUrl(n)+c+"/login/callback",scopes:e.scopes,expiration:e.expiration,nonce:f,state:s});o.redirect(l)}),l.post(c+"/login/callback",o(),function(n,i,o){var c;try{c=s.decode(n.body.id_token)}catch(e){c=null}if(!c||!n.cookies||n.cookies[r]!==c.nonce)return o(new a.ValidationError("Login failed. Nonce mismatch."));if(!n.cookies||n.cookies[t]!==n.body.state)return o(new a.ValidationError("Login failed. State mismatch."));return new a.SessionManager(e.rta,e.domain,e.baseUrl).create(n.body.id_token,n.body.access_token,{secret:e.secret,issuer:e.baseUrl,audience:e.audience}).then(function(e){i.header("Content-Type","text/html"),i.status(200).send('<html><head><script type="text/javascript">sessionStorage.setItem("'+f+'", "'+e+'");window.location.href = "'+u.getBaseUrl(n)+'";<\/script></head></html>')}).catch(function(e){o(e)})}),l.get(c+"/logout",function(t,r){const n=encodeURIComponent(u.getBaseUrl(t));r.header("Content-Type","text/html"),r.status(200).send('<html><head><script type="text/javascript">sessionStorage.removeItem("'+f+'");window.location.href = "https://'+e.rta+"/v2/logout/?returnTo="+n+"&client_id="+n+'";<\/script></head></html>')}),l.get("/.well-known/oauth2-client-configuration",function(t,r){r.header("Content-Type","application/json"),r.status(200).send({redirect_uris:[u.getBaseUrl(t)+c+"/login/callback"],client_name:e.clientName,post_logout_redirect_uris:[u.getBaseUrl(t)]})}),l}},function(e,t,r){e.exports.dashboardAdmins=r(51)},function(e,t,r){const n=r(1),i=r(128);e.exports.createServer=function(e){const t=n.createServer(e);var r=null;return i.fromExpress(function(e,n){return r||(r=t(e.webtaskContext)),r(e,n)})}},function(e,t,r){"use strict";var n,i=r(60),o=(n=i)&&n.__esModule?n:{default:n};var s=r(113),a=(r(126),r(123)),u=(r(22),r(89)),c=r(114),f=r(2),l=r(5);e.exports=function(e){return function(t,r,n){var i=t.webtaskContext&&t.webtaskContext.body||t.body||{},h=t.webtaskContext&&t.webtaskContext.headers||{};if(!(i.schedule&&"active"===i.state||h.referer===f("AUTH0_MANAGE_URL")+"/"&&h["if-none-match"]))return n();var p={host:f("FLUENTD_HOST"),port:f("FLUENTD_PORT"),security:{},timeout:3,tls:"true"===f("FLUENTD_TLS")},d=f("FLUENTD_SHARED_KEY");d&&(p.security.sharedKey=d),u.configure("auth0",p);var v=Date.now(),g=function(e,t){if(!e)return t();var r={post_date:v,type_description:c.logTypes.get(e.type)};(0,o.default)(e).forEach(function(t){r[t]=e[t]}),u.emit(r,t)},m=new c.reporters.SlackReporter({hook:f("SLACK_INCOMING_WEBHOOK_URL"),username:"auth0-logs-to-fluentd",title:"Logs To Fluentd"}),y={domain:f("AUTH0_DOMAIN"),clientId:f("AUTH0_CLIENT_ID"),clientSecret:f("AUTH0_CLIENT_SECRET"),batchSize:parseInt(f("BATCH_SIZE"),10),startFrom:f("START_FROM"),logTypes:f("LOG_TYPES"),logLevel:f("LOG_LEVEL")};(!y.batchSize||y.batchSize>100)&&(y.batchSize=100),y.logTypes&&!Array.isArray(y.logTypes)&&(y.logTypes=y.logTypes.replace(/\s/g,"").split(","));var x=new c.LogsProcessor(e,y),w=function(){e.read().then(function(t){var r,n,i,o=a().format("DD-MM-YYYY"),s=f("DAILY_REPORT_TIME")||16;t.lastReportDate!==o&&(new Date).getHours()>=s&&(r=o,n=(new Date).getTime(),i=n-864e5,x.getReport(i,n).then(function(e){return m.send(e,e.checkpoint)}).then(function(){return e.read()}).then(function(t){return t.lastReportDate=r,e.write(t)}))})};return x.run(function(e,t){if(!e||!e.length)return t();l.info("Sending "+e.length+" logs to Fluentd."),s.eachLimit(e,10,g,t)}).then(function(e){e&&e.status&&e.status.error?m.send(e.status,e.checkpoint):!0!==f("SLACK_SEND_SUCCESS")&&"true"!==f("SLACK_SEND_SUCCESS")||m.send(e.status,e.checkpoint),w(),r.json(e)}).catch(function(e){m.send({error:e,logsProcessed:0},null),w(),n(e)})}}},function(e,t,r){"use strict";var n=r(4).Router,i=r(3).middlewares,o=r(2),s=r(5);e.exports=function(){var e=n(),t=i.validateHookToken(o("AUTH0_DOMAIN"),o("WT_URL"),o("EXTENSION_SECRET"));return e.use("/on-uninstall",t("/.extensions/on-uninstall")),e.use(i.managementApiClient({domain:o("AUTH0_DOMAIN"),clientId:o("AUTH0_CLIENT_ID"),clientSecret:o("AUTH0_CLIENT_SECRET")})),e.delete("/on-uninstall",function(e,t){var r=o("AUTH0_CLIENT_ID");e.auth0.clients.delete({client_id:r}).then(function(){s.debug("Deleted client "+r),t.sendStatus(204)}).catch(function(e){s.debug("Error deleting client: "+o("AUTH0_CLIENT_ID")),s.error(e),t.sendStatus(204)})}),e}},function(e,t,r){"use strict";(function(t){r(119);var n=r(117),i=(r(40),r(3).urlHelpers),o=r(2);e.exports=function(){var e='\n  <!DOCTYPE html>\n  <html lang="en">\n  <head>\n    <title><%= config.TITLE %></title>\n    <meta charset="UTF-8" />\n    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/4.6.13/lib/logos/img/favicon.png">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.1672/css/index.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/4.6.13/index.min.css" />\n    <% if (assets.style) { %><link rel="stylesheet" type="text/css" href="/app/<%= assets.style %>" /><% } %>\n    <% if (assets.version) { %><link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-logs-to-logstash/assets/auth0-logs-to-logstash.ui.2.1.0.css" /><% } %>\n    <% if (assets.customCss) { %><link rel="stylesheet" type="text/css" href="<%= assets.customCss %>" /><% } %>\n  </head>\n  <body>\n    <div id="app"></div>\n    <script type="text/javascript" src="//cdn.auth0.com/w2/auth0-7.0.4.min.js"><\/script>\n    <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.1672/js/bundle.js"><\/script>\n    <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;<\/script>\n    <% if (assets.vendors) { %><script type="text/javascript" src="/app/<%= assets.vendors %>"><\/script><% } %>\n    <% if (assets.app) { %><script type="text/javascript" src="/app/<%= assets.app %>"><\/script><% } %>\n    <% if (assets.version) { %>\n    <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-logs-to-logstash/assets/auth0-logs-to-logstash.ui.vendors.2.1.0.js"><\/script>\n    <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-logs-to-logstash/assets/auth0-logs-to-logstash.ui.2.1.0.js"><\/script>\n    <% } %>\n  </body>\n  </html>\n  ';return function(t,r,s){if(0===t.url.indexOf("/api"))return s();var a={AUTH0_DOMAIN:o("AUTH0_DOMAIN"),AUTH0_CLIENT_ID:o("EXTENSION_CLIENT_ID"),AUTH0_MANAGE_URL:o("AUTH0_MANAGE_URL")||"https://manage.auth0.com",BASE_URL:i.getBaseUrl(t),BASE_PATH:i.getBasePath(t),TITLE:o("TITLE")};return r.send(n.render(e,{config:a,assets:{customCss:o("CUSTOM_CSS"),version:"1.0.0"}}))}}}).call(t,"/")},function(e,t,r){"use strict";var n=r(122),i=r(4).Router,o=r(3).middlewares,s=r(2),a=r(56);e.exports=function(e){var t=i(),r=o.authenticateAdmins({credentialsRequired:!0,secret:s("EXTENSION_SECRET"),audience:"urn:logs-to-fluentd",baseUrl:s("PUBLIC_WT_URL")||s("WT_URL"),onLoginSuccess:function(e,t,r){return r()}});return t.get("/",a()),t.get("/api/report",r,function(t,r,i){return e.read().then(function(e){var i=e&&e.logs?n.sortByOrder(e.logs,"start","desc"):[],o=t.query.filter&&"errors"===t.query.filter?n.filter(i,function(e){return!!e.error}):i,s=t.query.page&&parseInt(t.query.page)?parseInt(t.query.page)-1:0,a=t.query.per_page&&parseInt(t.query.per_page)||10,u=a*s;return r.json({logs:o.slice(u,u+a),total:o.length})}).catch(i)}),t}},function(e,t,r){"use strict";var n=r(4),i=r(92);e.exports=function(){var e=n.Router();return e.get("/",function(e,t){t.status(200).send(i)}),e}},function(e,t,r){"use strict";var n=r(3),i=r(42),o=r(2),s=r(5),a=n.createServer(function(e,t){return s.info("Starting Auth0 Logs to Fluentd Extension - Version:","1.0.0"),i(e,t)});e.exports=function(e,t,r){o.setValue("PUBLIC_WT_URL",n.urlHelpers.getWebtaskUrl(t)),a(e,t,r)}},function(e,t,r){e.exports={default:r(63),__esModule:!0}},function(e,t,r){"use strict";
/*!
 * cookie-parser
 * Copyright(c) 2014 TJ Holowaychuk
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var n=r(62),i=r(116);function o(e){if("string"==typeof e&&"j:"===e.substr(0,2))try{return JSON.parse(e.slice(2))}catch(e){return}}function s(e){for(var t,r,n=Object.keys(e),i=0;i<n.length;i++)(r=o(e[t=n[i]]))&&(e[t]=r);return e}function a(e,t){if("string"==typeof e){if("s:"!==e.substr(0,2))return e;for(var r=!t||Array.isArray(t)?t||[]:[t],n=0;n<r.length;n++){var o=i.unsign(e.slice(2),r[n]);if(!1!==o)return o}return!1}}function u(e,t){for(var r,n,i,o=Object.keys(e),s=Object.create(null),u=0;u<o.length;u++)(i=e[n=o[u]])!==(r=a(i,t))&&(s[n]=r,delete e[n]);return s}e.exports=function(e,t){return function(r,i,o){if(r.cookies)return o();var a=r.headers.cookie,c=!e||Array.isArray(e)?e||[]:[e];if(r.secret=c[0],r.cookies=Object.create(null),r.signedCookies=Object.create(null),!a)return o();r.cookies=n.parse(a,t),0!==c.length&&(r.signedCookies=u(r.cookies,c),r.signedCookies=s(r.signedCookies)),r.cookies=s(r.cookies),o()}},e.exports.JSONCookie=o,e.exports.JSONCookies=s,e.exports.signedCookie=a,e.exports.signedCookies=u},function(e,t,r){"use strict";
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */t.parse=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var r={},i=t||{},s=e.split(o),u=i.decode||n,c=0;c<s.length;c++){var f=s[c],l=f.indexOf("=");if(!(l<0)){var h=f.substr(0,l).trim(),p=f.substr(++l,f.length).trim();'"'==p[0]&&(p=p.slice(1,-1)),null==r[h]&&(r[h]=a(p,u))}}return r},t.serialize=function(e,t,r){var n=r||{},o=n.encode||i;if("function"!=typeof o)throw new TypeError("option encode is invalid");if(!s.test(e))throw new TypeError("argument name is invalid");var a=o(t);if(a&&!s.test(a))throw new TypeError("argument val is invalid");var u=e+"="+a;if(null!=n.maxAge){var c=n.maxAge-0;if(isNaN(c))throw new Error("maxAge should be a Number");u+="; Max-Age="+Math.floor(c)}if(n.domain){if(!s.test(n.domain))throw new TypeError("option domain is invalid");u+="; Domain="+n.domain}if(n.path){if(!s.test(n.path))throw new TypeError("option path is invalid");u+="; Path="+n.path}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");u+="; Expires="+n.expires.toUTCString()}n.httpOnly&&(u+="; HttpOnly");n.secure&&(u+="; Secure");if(n.sameSite){var f="string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite;switch(f){case!0:u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"strict":u+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return u};var n=decodeURIComponent,i=encodeURIComponent,o=/; */,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function a(e,t){try{return t(e)}catch(t){return e}}},function(e,t,r){r(88),e.exports=r(8).Object.keys},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var n=r(12);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var n=r(27),i=r(84),o=r(83);e.exports=function(e){return function(t,r,s){var a,u=n(t),c=i(u.length),f=o(s,c);if(e&&r!=r){for(;c>f;)if((a=u[f++])!=a)return!0}else for(;c>f;f++)if((e||f in u)&&u[f]===r)return e||f||0;return!e&&-1}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(64);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(12),i=r(11).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(11),i=r(8),o=r(68),s=r(73),a=function(e,t,r){var u,c,f,l=e&a.F,h=e&a.G,p=e&a.S,d=e&a.P,v=e&a.B,g=e&a.W,m=h?i:i[t]||(i[t]={}),y=m.prototype,x=h?n:p?n[t]:(n[t]||{}).prototype;for(u in h&&(r=t),r)(c=!l&&x&&void 0!==x[u])&&u in m||(f=c?x[u]:r[u],m[u]=h&&"function"!=typeof x[u]?r[u]:v&&c?o(f,n):g&&x[u]==f?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):d&&"function"==typeof f?o(Function.call,f):f,d&&((m.virtual||(m.virtual={}))[u]=f,e&a.R&&y&&!y[u]&&s(y,u,f)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,e.exports=a},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(76),i=r(80);e.exports=r(9)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=!r(9)&&!r(10)(function(){return 7!=Object.defineProperty(r(69)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(67);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(65),i=r(74),o=r(86),s=Object.defineProperty;t.f=r(9)?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(72),i=r(27),o=r(66)(!1),s=r(81)("IE_PROTO");e.exports=function(e,t){var r,a=i(e),u=0,c=[];for(r in a)r!=s&&n(a,r)&&c.push(r);for(;t.length>u;)n(a,r=t[u++])&&(~o(c,r)||c.push(r));return c}},function(e,t,r){var n=r(77),i=r(70);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=r(71),i=r(8),o=r(10);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],s={};s[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",s)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(82)("keys"),i=r(87);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var n=r(11),i=n["__core-js_shared__"]||(n["__core-js_shared__"]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t,r){var n=r(26),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},function(e,t,r){var n=r(26),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=r(25);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n=r(12);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(85),i=r(78);r(79)("keys",function(){return function(e){return i(n(e))}})},function(e,t,r){"use strict";var n=r(30).FluentSender,i=new n("debug"),o=r(29).EventTime;e.exports={configure:function(e){i.end();var t=e,r=arguments[1];(i=new n(t,r))._setupErrorHandler()},createFluentSender:function(e,t){var r=new n(e,t);return r._setupErrorHandler(),r},support:{winstonTransport:function(){return r(91).Transport}},EventTime:o};["emit","end","addListener","on","once","removeListener","removeAllListeners","setMaxListeners","getMaxListeners"].forEach((t,r)=>{e.exports[t]=function(){if(i)return i[t].apply(i,Array.prototype.slice.call(arguments))}})},function(e,t,r){"use strict";var n=r(7);e.exports={};var i=function(e,t){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e,this.options=t};n.inherits(i,Error);var o=function e(t,r){e.super_.call(this,t,r)};n.inherits(o,i);var s=function e(t,r){e.super_.call(this,t,r)};n.inherits(s,i);var a=function(e,t){s.super_.call(this,e,t)};n.inherits(a,i);var u=function e(t,r){e.super_.call(this,t,r)};n.inherits(u,i);var c=function e(t,r){e.super_.call(this,t,r)};n.inherits(c,i);var f=function e(t,r){e.super_.call(this,t,r)};n.inherits(f,i),e.exports={ConfigError:o,MissingTag:s,ResponseError:a,DataTypeError:c,ResponseTimeout:u,HandshakeError:f}},function(e,t,r){"use strict";var n=r(30),i=r(7),o=r(41).Transport,s="winston";function a(e,t){0===arguments.length?e=s:"object"==typeof e&&(t=e,e=s),t=t||{},this.sender=new n.FluentSender(e,t),o.call(this,t)}i.inherits(a,o),a.prototype.log=function(e,t,r,n){var i={level:e,message:t,meta:r};this.sender.emit(i,e=>{e?(this.emit("error",e),n(e,!1)):(this.emit("logged"),n(null,!0))})},a.prototype.name="fluent",e.exports.Transport=a},function(e,t){e.exports={title:"Auth0 Logs to Fluentd",name:"auth0-logs-to-fluentd",version:"1.0.0",preVersion:"1.0.0",author:"goabout",category:"log_export",description:"This extension will continuously export your Auth0 logs to Fluentd",type:"cron",initialUrlPath:"/login",repository:"https://github.com/goabout/auth0-logs-to-fluentd",docsUrl:"https://github.com/goabout/auth0-logs-to-fluentd",logoUrl:"https://avatars1.githubusercontent.com/u/859518",keywords:["auth0","extension"],schedule:"0 */5 * * * *",auth0:{createClient:!0,onUninstallPath:"/.extensions/on-uninstall",scopes:"read:logs delete:clients"},secrets:{BATCH_SIZE:{description:"The amount of logs to batch before sending to Fluentd. A single cron execution will send multiple batches.",default:100},FLUENTD_HOST:{description:"Fluentd host",example:"example.com",required:!0},FLUENTD_PORT:{description:"Fluentd port",example:"24224",required:!0},FLUENTD_TLS:{description:"This setting will enable TLS for the connection to Fluentd",type:"select",allowMultiple:!1,default:"false",options:[{value:"false",text:"No"},{value:"true",text:"Yes"}]},FLUENTD_SHARED_KEY:{description:"Fluentd shared key(optional)",type:"password"},START_FROM:{description:"Checkpoint ID of log to start from."},SLACK_INCOMING_WEBHOOK_URL:{description:"Slack Incoming Webhook URL used to report statistics and possible failures"},SLACK_SEND_SUCCESS:{description:"This setting will enable verbose notifications to Slack which are useful for troubleshooting",type:"select",allowMultiple:!1,default:"false",options:[{value:"false",text:"No"},{value:"true",text:"Yes"}]},LOG_LEVEL:{description:"This allows you to specify the log level of events that need to be sent",type:"select",allowMultiple:!0,options:[{value:"-",text:""},{value:"0",text:"Debug"},{value:"1",text:"Info"},{value:"2",text:"Warning"},{value:"3",text:"Error"},{value:"4",text:"Critical"}]},LOG_TYPES:{description:"If you only want to send events with a specific type (eg: failed logins)",type:"select",allowMultiple:!0,options:[{text:"",value:"-"},{text:"Success Login",value:"s"},{text:"Success Exchange",value:"seacft"},{text:"Success Exchange (Client Credentials)",value:"seccft"},{text:"Failed Exchange",value:"feacft"},{text:"Failed Exchange (Client Credentials)",value:"feccft"},{text:"Failed Login",value:"f"},{text:"Warnings During Login",value:"w"},{text:"Deleted User",value:"du"},{text:"Failed Login (invalid email/username)",value:"fu"},{text:"Failed Login (wrong password)",value:"fp"},{text:"Failed by Connector",value:"fc"},{text:"Failed by CORS",value:"fco"},{text:"Connector Online",value:"con"},{text:"Connector Offline",value:"coff"},{text:"Failed Connector Provisioning",value:"fcpro"},{text:"Success Signup",value:"ss"},{text:"Failed Signup",value:"fs"},{text:"Code Sent",value:"cs"},{text:"Code/Link Sent",value:"cls"},{text:"Success Verification Email",value:"sv"},{text:"Failed Verification Email",value:"fv"},{text:"Success Change Password",value:"scp"},{text:"Failed Change Password",value:"fcp"},{text:"Success Change Email",value:"sce"},{text:"Failed Change Email",value:"fce"},{text:"Success Change Username",value:"scu"},{text:"Failed Change Username",value:"fcu"},{text:"Success Change Phone Number",value:"scpn"},{text:"Failed Change Phone Number",value:"fcpn"},{text:"Success Verification Email Request",value:"svr"},{text:"Failed Verification Email Request",value:"fvr"},{text:"Success Change Password Request",value:"scpr"},{text:"Failed Change Password Request",value:"fcpr"},{text:"Failed Sending Notification",value:"fn"},{text:"API Operation",value:"sapi"},{text:"Failed API Operation",value:"fapi"},{text:"Blocked Account",value:"limit_wc"},{text:"Too Many Calls to /userinfo",value:"limit_ui"},{text:"Rate Limit On API",value:"api_limit"},{text:"Successful User Deletion",value:"sdu"},{text:"Failed User Deletion",value:"fdu"},{text:"Blocked Account",value:"limit_wc"},{text:"Blocked IP Address",value:"limit_mu"},{text:"Success Logout",value:"slo"},{text:"Failed Logout",value:"flo"},{text:"Success Delegation",value:"sd"},{text:"Failed Delegation",value:"fd"}]}}}},function(e,t){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(e){this.message=e}n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,o,s=0,a=0,u="";o=t.charAt(a++);~o&&(i=s%4?64*i+o:o,s++%4)?u+=String.fromCharCode(255&i>>(-2*s&6)):0)o=r.indexOf(o);return u}},function(e,t,r){var n=r(93);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(n(e).replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(t)}catch(e){return n(t)}}},function(e,t,r){t.encode=r(34).encode,t.decode=r(33).decode,t.Encoder=r(105).Encoder,t.Decoder=r(103).Decoder,t.createEncodeStream=r(104).createEncodeStream,t.createDecodeStream=r(102).createDecodeStream,t.createCodec=r(108).createCodec,t.codec=r(101).codec},function(e,t){function r(e){return e&&e.isBuffer&&e}e.exports=r("undefined"!=typeof Buffer&&Buffer)||r(this.Buffer)||r("undefined"!=typeof window&&window.Buffer)||this.Buffer},function(e,t){t.copy=function(e,t,r,n){var i;r||(r=0);n||0===n||(n=this.length);t||(t=0);var o=n-r;if(e===this&&r<t&&t<n)for(i=o-1;i>=0;i--)e[i+t]=this[i+r];else for(i=0;i<o;i++)e[i+t]=this[i+r];return o},t.toString=function(e,t,r){var n=0|t;r||(r=this.length);var i="",o=0;for(;n<r;)(o=this[n++])<128?i+=String.fromCharCode(o):(192==(224&o)?o=(31&o)<<6|63&this[n++]:224==(240&o)?o=(15&o)<<12|(63&this[n++])<<6|63&this[n++]:240==(248&o)&&(o=(7&o)<<18|(63&this[n++])<<12|(63&this[n++])<<6|63&this[n++]),o>=65536?(o-=65536,i+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):i+=String.fromCharCode(o));return i},t.write=function(e,t){var r=t||(t|=0),n=e.length,i=0,o=0;for(;o<n;)(i=e.charCodeAt(o++))<128?this[r++]=i:i<2048?(this[r++]=192|i>>>6,this[r++]=128|63&i):i<55296||i>57343?(this[r++]=224|i>>>12,this[r++]=128|i>>>6&63,this[r++]=128|63&i):(i=65536+(i-55296<<10|e.charCodeAt(o++)-56320),this[r++]=240|i>>>18,this[r++]=128|i>>>12&63,this[r++]=128|i>>>6&63,this[r++]=128|63&i);return r-t}},function(e,t,r){var n=r(0);function i(e){return new Array(e)}(t=e.exports=i(0)).alloc=i,t.concat=n.concat,t.from=function(e){if(!n.isBuffer(e)&&n.isView(e))e=n.Uint8Array.from(e);else if(n.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return n.from.call(t,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(e)}},function(e,t,r){var n=r(0),i=n.global;function o(e){return new i(e)}(t=e.exports=n.hasBuffer?o(0):[]).alloc=n.hasBuffer&&i.alloc||o,t.concat=n.concat,t.from=function(e){if(!n.isBuffer(e)&&n.isView(e))e=n.Uint8Array.from(e);else if(n.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return n.from.call(t,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return i.from&&1!==i.from.length?i.from(e):new i(e)}},function(e,t,r){var n=r(0);function i(e){return new Uint8Array(e)}(t=e.exports=n.hasArrayBuffer?i(0):[]).alloc=i,t.concat=n.concat,t.from=function(e){if(n.isView(e)){var r=e.byteOffset,i=e.byteLength;(e=e.buffer).byteLength!==i&&(e.slice?e=e.slice(r,r+i):(e=new Uint8Array(e)).byteLength!==i&&(e=Array.prototype.slice.call(e,r,r+i)))}else{if("string"==typeof e)return n.from.call(t,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(e)}},function(e,t,r){r(19),r(20),t.codec={preset:r(6).preset}},function(e,t,r){t.createDecodeStream=a;var n=r(7),i=r(21).Transform,o=r(16).DecodeBuffer;n.inherits(a,i);var s={objectMode:!0};function a(e){if(!(this instanceof a))return new a(e);e?e.objectMode=!0:e=s,i.call(this,e);var t=this;(this.decoder=new o(e)).push=function(e){t.push(e)}}a.prototype._transform=function(e,t,r){this.decoder.write(e),this.decoder.flush(),r&&r()}},function(e,t,r){t.Decoder=o;var n=r(28),i=r(16).DecodeBuffer;function o(e){if(!(this instanceof o))return new o(e);i.call(this,e)}o.prototype=new i,n.mixin(o.prototype),o.prototype.decode=function(e){arguments.length&&this.write(e),this.flush()},o.prototype.push=function(e){this.emit("data",e)},o.prototype.end=function(e){this.decode(e),this.emit("end")}},function(e,t,r){t.createEncodeStream=a;var n=r(7),i=r(21).Transform,o=r(17).EncodeBuffer;n.inherits(a,i);var s={objectMode:!0};function a(e){if(!(this instanceof a))return new a(e);e?e.objectMode=!0:e=s,i.call(this,e);var t=this;(this.encoder=new o(e)).push=function(e){t.push(e)}}a.prototype._transform=function(e,t,r){this.encoder.write(e),r&&r()},a.prototype._flush=function(e){this.encoder.flush(),e&&e()}},function(e,t,r){t.Encoder=o;var n=r(28),i=r(17).EncodeBuffer;function o(e){if(!(this instanceof o))return new o(e);i.call(this,e)}o.prototype=new i,n.mixin(o.prototype),o.prototype.encode=function(e){this.write(e),this.emit("data",this.read())},o.prototype.end=function(e){arguments.length&&this.encode(e),this.flush(),this.emit("end")}},function(e,t,r){t.setExtPackers=function(e){e.addExtPacker(14,Error,[l,u]),e.addExtPacker(1,EvalError,[l,u]),e.addExtPacker(2,RangeError,[l,u]),e.addExtPacker(3,ReferenceError,[l,u]),e.addExtPacker(4,SyntaxError,[l,u]),e.addExtPacker(5,TypeError,[l,u]),e.addExtPacker(6,URIError,[l,u]),e.addExtPacker(10,RegExp,[f,u]),e.addExtPacker(11,Boolean,[c,u]),e.addExtPacker(12,String,[c,u]),e.addExtPacker(13,Date,[Number,u]),e.addExtPacker(15,Number,[c,u]),"undefined"!=typeof Uint8Array&&(e.addExtPacker(17,Int8Array,s),e.addExtPacker(18,Uint8Array,s),e.addExtPacker(19,Int16Array,s),e.addExtPacker(20,Uint16Array,s),e.addExtPacker(21,Int32Array,s),e.addExtPacker(22,Uint32Array,s),e.addExtPacker(23,Float32Array,s),"undefined"!=typeof Float64Array&&e.addExtPacker(24,Float64Array,s),"undefined"!=typeof Uint8ClampedArray&&e.addExtPacker(25,Uint8ClampedArray,s),e.addExtPacker(26,ArrayBuffer,s),e.addExtPacker(29,DataView,s));i.hasBuffer&&e.addExtPacker(27,o,i.from)};var n,i=r(0),o=i.global,s=i.Uint8Array.from,a={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function u(e){return n||(n=r(34).encode),n(e)}function c(e){return e.valueOf()}function f(e){(e=RegExp.prototype.toString.call(e).split("/")).shift();var t=[e.pop()];return t.unshift(e.join("/")),t}function l(e){var t={};for(var r in a)t[r]=e[r];return t}},function(e,t,r){t.setExtUnpackers=function(e){e.addExtUnpacker(14,[a,c(Error)]),e.addExtUnpacker(1,[a,c(EvalError)]),e.addExtUnpacker(2,[a,c(RangeError)]),e.addExtUnpacker(3,[a,c(ReferenceError)]),e.addExtUnpacker(4,[a,c(SyntaxError)]),e.addExtUnpacker(5,[a,c(TypeError)]),e.addExtUnpacker(6,[a,c(URIError)]),e.addExtUnpacker(10,[a,u]),e.addExtUnpacker(11,[a,f(Boolean)]),e.addExtUnpacker(12,[a,f(String)]),e.addExtUnpacker(13,[a,f(Date)]),e.addExtUnpacker(15,[a,f(Number)]),"undefined"!=typeof Uint8Array&&(e.addExtUnpacker(17,f(Int8Array)),e.addExtUnpacker(18,f(Uint8Array)),e.addExtUnpacker(19,[l,f(Int16Array)]),e.addExtUnpacker(20,[l,f(Uint16Array)]),e.addExtUnpacker(21,[l,f(Int32Array)]),e.addExtUnpacker(22,[l,f(Uint32Array)]),e.addExtUnpacker(23,[l,f(Float32Array)]),"undefined"!=typeof Float64Array&&e.addExtUnpacker(24,[l,f(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&e.addExtUnpacker(25,f(Uint8ClampedArray)),e.addExtUnpacker(26,l),e.addExtUnpacker(29,[l,f(DataView)]));i.hasBuffer&&e.addExtUnpacker(27,f(o))};var n,i=r(0),o=i.global,s={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function a(e){return n||(n=r(33).decode),n(e)}function u(e){return RegExp.apply(null,e)}function c(e){return function(t){var r=new e;for(var n in s)r[n]=t[n];return r}}function f(e){return function(t){return new e(t)}}function l(e){return new Uint8Array(e).buffer}},function(e,t,r){r(19),r(20),t.createCodec=r(6).createCodec},function(e,t,r){var n=r(36);function i(e){var t,r=new Array(256);for(t=0;t<=127;t++)r[t]=o(t);for(t=128;t<=143;t++)r[t]=a(t-128,e.map);for(t=144;t<=159;t++)r[t]=a(t-144,e.array);for(t=160;t<=191;t++)r[t]=a(t-160,e.str);for(r[192]=o(null),r[193]=null,r[194]=o(!1),r[195]=o(!0),r[196]=s(e.uint8,e.bin),r[197]=s(e.uint16,e.bin),r[198]=s(e.uint32,e.bin),r[199]=s(e.uint8,e.ext),r[200]=s(e.uint16,e.ext),r[201]=s(e.uint32,e.ext),r[202]=e.float32,r[203]=e.float64,r[204]=e.uint8,r[205]=e.uint16,r[206]=e.uint32,r[207]=e.uint64,r[208]=e.int8,r[209]=e.int16,r[210]=e.int32,r[211]=e.int64,r[212]=a(1,e.ext),r[213]=a(2,e.ext),r[214]=a(4,e.ext),r[215]=a(8,e.ext),r[216]=a(16,e.ext),r[217]=s(e.uint8,e.str),r[218]=s(e.uint16,e.str),r[219]=s(e.uint32,e.str),r[220]=s(e.uint16,e.array),r[221]=s(e.uint32,e.array),r[222]=s(e.uint16,e.map),r[223]=s(e.uint32,e.map),t=224;t<=255;t++)r[t]=o(t-256);return r}function o(e){return function(){return e}}function s(e,t){return function(r){var n=e(r);return t(r,n)}}function a(e,t){return function(r){return t(r,e)}}t.getReadToken=function(e){var t=n.getReadFormat(e);return e&&e.useraw?function(e){var t,r=i(e).slice();for(r[217]=r[196],r[218]=r[197],r[219]=r[198],t=160;t<=191;t++)r[t]=a(t-160,e.bin);return r}(t):i(t)}},function(e,t,r){var n=r(31),i=r(13),o=i.Uint64BE,s=i.Int64BE,a=r(37).uint8,u=r(0),c=u.global,f=u.hasBuffer&&"TYPED_ARRAY_SUPPORT"in c&&!c.TYPED_ARRAY_SUPPORT,l=u.hasBuffer&&c.prototype||{};function h(){var e=a.slice();return e[196]=p(196),e[197]=d(197),e[198]=v(198),e[199]=p(199),e[200]=d(200),e[201]=v(201),e[202]=g(202,4,l.writeFloatBE||x,!0),e[203]=g(203,8,l.writeDoubleBE||w,!0),e[204]=p(204),e[205]=d(205),e[206]=v(206),e[207]=g(207,8,m),e[208]=p(208),e[209]=d(209),e[210]=v(210),e[211]=g(211,8,y),e[217]=p(217),e[218]=d(218),e[219]=v(219),e[220]=d(220),e[221]=v(221),e[222]=d(222),e[223]=v(223),e}function p(e){return function(t,r){var n=t.reserve(2),i=t.buffer;i[n++]=e,i[n]=r}}function d(e){return function(t,r){var n=t.reserve(3),i=t.buffer;i[n++]=e,i[n++]=r>>>8,i[n]=r}}function v(e){return function(t,r){var n=t.reserve(5),i=t.buffer;i[n++]=e,i[n++]=r>>>24,i[n++]=r>>>16,i[n++]=r>>>8,i[n]=r}}function g(e,t,r,n){return function(i,o){var s=i.reserve(t+1);i.buffer[s++]=e,r.call(i.buffer,o,s,n)}}function m(e,t){new o(this,t,e)}function y(e,t){new s(this,t,e)}function x(e,t){n.write(this,e,t,!1,23,4)}function w(e,t){n.write(this,e,t,!1,52,8)}t.getWriteToken=function(e){return e&&e.uint8array?((t=h())[202]=g(202,4,x),t[203]=g(203,8,w),t):f||u.hasBuffer&&e&&e.safe?function(){var e=a.slice();return e[196]=g(196,1,c.prototype.writeUInt8),e[197]=g(197,2,c.prototype.writeUInt16BE),e[198]=g(198,4,c.prototype.writeUInt32BE),e[199]=g(199,1,c.prototype.writeUInt8),e[200]=g(200,2,c.prototype.writeUInt16BE),e[201]=g(201,4,c.prototype.writeUInt32BE),e[202]=g(202,4,c.prototype.writeFloatBE),e[203]=g(203,8,c.prototype.writeDoubleBE),e[204]=g(204,1,c.prototype.writeUInt8),e[205]=g(205,2,c.prototype.writeUInt16BE),e[206]=g(206,4,c.prototype.writeUInt32BE),e[207]=g(207,8,m),e[208]=g(208,1,c.prototype.writeInt8),e[209]=g(209,2,c.prototype.writeInt16BE),e[210]=g(210,4,c.prototype.writeInt32BE),e[211]=g(211,8,y),e[217]=g(217,1,c.prototype.writeUInt8),e[218]=g(218,2,c.prototype.writeUInt16BE),e[219]=g(219,4,c.prototype.writeUInt32BE),e[220]=g(220,2,c.prototype.writeUInt16BE),e[221]=g(221,4,c.prototype.writeUInt32BE),e[222]=g(222,2,c.prototype.writeUInt16BE),e[223]=g(223,4,c.prototype.writeUInt32BE),e}():h();var t}},function(e,t,r){var n=r(14),i=r(13),o=i.Uint64BE,s=i.Int64BE,a=r(0),u=r(15),c=r(110),f=r(37).uint8,l=r(18).ExtBuffer,h="undefined"!=typeof Uint8Array,p="undefined"!=typeof Map,d=[];d[1]=212,d[2]=213,d[4]=214,d[8]=215,d[16]=216,t.getWriteType=function(e){var t=c.getWriteToken(e),r=e&&e.useraw,i=h&&e&&e.binarraybuffer,v=i?a.isArrayBuffer:a.isBuffer,g=i?function(e,t){w(e,new Uint8Array(t))}:w,m=p&&e&&e.usemap?function(e,r){if(!(r instanceof Map))return E(e,r);var n=r.size;t[n<16?128+n:n<=65535?222:223](e,n);var i=e.codec.encode;r.forEach(function(t,r,n){i(e,r),i(e,t)})}:E;return{boolean:function(e,r){t[r?195:194](e,r)},function:x,number:function(e,r){var n,i=0|r;if(r!==i)return void t[n=203](e,r);n=-32<=i&&i<=127?255&i:0<=i?i<=255?204:i<=65535?205:206:-128<=i?208:-32768<=i?209:210;t[n](e,i)},object:r?function(e,r){if(v(r))return function(e,r){var n=r.length;t[n<32?160+n:n<=65535?218:219](e,n),e.send(r)}(e,r);y(e,r)}:y,string:function(e){return function(r,n){var i=n.length,o=5+3*i;r.offset=r.reserve(o);var s=r.buffer,a=e(i),c=r.offset+a;i=u.write.call(s,n,c);var f=e(i);if(a!==f){var l=c+f-a,h=c+i;u.copy.call(s,s,l,c,h)}t[1===f?160+i:f<=3?215+f:219](r,i),r.offset+=i}}(r?function(e){return e<32?1:e<=65535?3:5}:function(e){return e<32?1:e<=255?2:e<=65535?3:5}),symbol:x,undefined:x};function y(e,r){if(null===r)return x(e,r);if(v(r))return g(e,r);if(n(r))return function(e,r){var n=r.length;t[n<16?144+n:n<=65535?220:221](e,n);for(var i=e.codec.encode,o=0;o<n;o++)i(e,r[o])}(e,r);if(o.isUint64BE(r))return function(e,r){t[207](e,r.toArray())}(e,r);if(s.isInt64BE(r))return function(e,r){t[211](e,r.toArray())}(e,r);var i=e.codec.getExtPacker(r);if(i&&(r=i(r)),r instanceof l)return function(e,r){var n=r.buffer,i=n.length,o=d[i]||(i<255?199:i<=65535?200:201);t[o](e,i),f[r.type](e),e.send(n)}(e,r);m(e,r)}function x(e,r){t[192](e,r)}function w(e,r){var n=r.length,i=n<255?196:n<=65535?197:198;t[i](e,n),e.send(r)}function E(e,r){var n=Object.keys(r),i=n.length,o=i<16?128+i:i<=65535?222:223;t[o](e,i);var s=e.codec.encode;n.forEach(function(t){s(e,t),s(e,r[t])})}}},function(e,t,r){var n=r(129);function i(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function o(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}e.exports=n(i),e.exports.strict=n(o),i.proto=i(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})})},function(e,t){e.exports=require("async@2.1.2")},function(e,t){e.exports=require("auth0-log-extension-tools@1.3.6")},function(e,t){e.exports=require("body-parser@1.12.4")},function(e,t){e.exports=require("cookie-signature@1.0.6")},function(e,t){e.exports=require("ejs@2.3.1")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("jsonwebtoken@7.1.9")},function(e,t){e.exports=require("jwks-rsa@1.1.1")},function(e,t){e.exports=require("lodash@3.10.1")},function(e,t){e.exports=require("moment@2.10.3")},function(e,t){e.exports=require("morgan@1.5.3")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("request@2.56.0")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("webtask-tools")},function(e,t){e.exports=require("wrappy@1.0.1")},function(e,t){e.exports=require("zlib")}]);